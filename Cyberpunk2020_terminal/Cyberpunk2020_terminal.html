<div class="body">
	<!-- Header Panel-->
	<div class="headerpanel" style="width:98%;margin:0 auto 0 auto;">
		<img style="display:block;margin:0 auto 0 auto" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Cyberpunk2020_ternminal/cyberpunk-logo.png" />
		<h5 style="width:100%;float:left;text-align:left;font-size:13px;">Basics</h5>
		<span style="width:10%;float:left;text-align:right;">Handle&nbsp;</span>
		<span style="width:88%;float:left;"><input type="text" name="attr_character_name" style="width:100%;"></span>
		<span style="width:10%; float:left;text-align:right;">Role&nbsp;</span>
		<span style="width:20%;float:left;">
			<select name="attr_character_role" style="width:100%;">
				<option value="rockerboy">Rockerboy</option>
				<option value="solo">Solo</option>
				<option value="netrunner">Netrunner</option>
				<option value="cop">Cop</option>
				<option value="corporate">Corporate</option>
				<option value="fixer">Fixer</option>
				<option value="tech">Tech</option>
				<option value="medtech">MedTech</option>
				<option value="nomad">Nomad</option>
				<option value="media">Media</option>
			</select>
		</span>
		<span style="width:7%;float:left;text-align:right;">Age&nbsp;</span>
		<span style="width:5%;float:left;"><input type="text" name="attr_age" value="16" maxlength=2 style="width:100%;" /></span>
		<span style="width:7%;float:left;text-align:right;">Gender&nbsp;</span>
		<span style="width:20%;float:left;">
			<select name="attr_sex" style="width:100%;">
				<option value="M">Male</option>
				<option value="F">Female</option>
				<option value="O">Other</option>
			</select>
		</span>
		<span style="width:10%;float:left;text-align:right;">Cash â‚¬&nbsp;</span>
		<span style="width:7%;float:left;"><input type="text" name="attr_money" value="0" style="width:100%;"></span>
		<span style="width:7%;float:left;text-align:right;">IP&nbsp;</span>
		<span style="width:5%;float:left;"><input type="text" name="attr_ip" value="0" style="width:100%;"></span>
		
		<span style="width:100%;float:left;">
			<!-- PENALTY HOLDERS -->
			<input type="hidden" name="attr_ref_penalty" value="0" style="width:10%;"><input type="hidden" name="attr_int_penalty" value="0" style="width:10%;">
			<input type="hidden" name="attr_tech_penalty" value="0" style="width:10%;"><input type="hidden" name="attr_cool_penalty" value="0" style="width:10%;">
			<input type="hidden" name="attr_body_penalty" value="0" style="width:10%;"><input type="hidden" name="attr_attr_penalty" value="0" style="width:10%;">
			<input type="hidden" name="attr_luck_penalty" value="0" style="width:10%;"><input type="hidden" name="attr_ma_penalty" value="0" style="width:10%;">
			<input type="hidden" name="attr_emp_penalty" value="0" style="width:10%;"><input type="hidden" name="attr_total_cyb" value="0" style="width:10%;">
			<input type="hidden" name="attr_enc" value="0">
		</span>
		
		<!-- STATS -->
		<div style="width:98%;float:left;margin:0 auto 0 auto;">
			<table style="font-size:10px;width:100%;">
				<tr>
					<td style="width:49%;" ><h5 style="width:100%;float:left;text-align:center;font-size:13px;">- Stats -</h5></td>
					<td style="width:49%;" ><h5 style="width:100%;float:left;text-align:center;font-size:13px;">- Health -</h5></td>
				</tr>			
				<tr>
					<td style="width:49%;" >
						<table style="width:98%;margin:0 auto 0 auto;">
							<tr>
								<td style="width:8%; text-align:right;"><span>&nbsp;</span></td>
								<td style="width:10%; text-align:center;">
									<button alt="Intelligence" type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Intelligence}} {{result=[[1d10!cf<1 + @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{int}]]}}">
										<label class="labelbutton" style="text-align:center">INT</label>
									</button>
								</td>
								<td style="width:10%; text-align:center;">
									<button alt="Reflexes" type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Reflexes}} {{result=[[1d10!cf<1 + @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{ref}]]}}">
										<label class="labelbutton" style="text-align:center">REF</label>
									</button>	
								</td>
								<td style="width:10%; text-align:center;">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Tech}} {{result=[[1d10!cf<1 + @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{tech}]]}}">
										<label class="labelbutton" style="text-align:center">TECH</label>
									</button>
								</td>
								<td style="width:10%; text-align:center;">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Cool}} {{result=[[1d10!cf<1 + @{cool} + @{cool_mod} - @{cool_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{cool}]]}}">
										<label class="labelbutton" style="text-align:center">COOL</label>
									</button>
								</td>					
								<td style="width:10%; text-align:center;">
									<button alt="Attractiveness" type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Attractiveness}} {{result=[[1d10!cf<1 + @{attr} + @{attr_mod} - @{attr_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{attr}]]}}">
										<label class="labelbutton" style="text-align:center">ATTR</label>
									</button>
								</td>
								<td style="width:10%; text-align:center;">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Luck}} {{result=[[1d10!cf<1 + @{int} + @{luck_mod} - @{luck_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{luck}]]}}">
										<label class="labelbutton" style="text-align:center">LUCK</label>
									</button>
								</td>
								<td style="width:10%; text-align:center;">
									<button type="roll" value="">
										<label class="labelbutton" style="text-align:center">&nbsp;MA&nbsp;</label>
									</button>
								</td>
								<td style="width:10%; text-align:center;">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Body}} {{result=[[1d10!cf<1 + @{body} + @{body_mod} - @{body_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{body}]]}}">
										<label class="labelbutton" style="text-align:center">BODY</label>
									</button>
								</td>
								<td style="width:10%; text-align:center;">
									<button alt="Empathy" type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Empathy}} {{result=[[1d10!cf<1 + @{emp} + @{emp_mod} - @{emp_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{emp}]]}}">
										<label class="labelbutton" style="text-align:center">EMP</label>
									</button>
								</td>
							</tr>
							<tr>
								<td style="width:8%; text-align:right;"><span>Value.</span></td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_int" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_ref" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_tech" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_cool" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_attr" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_luck" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_ma" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_body" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_emp" style="width:50%;text-align:center;"/>]</td>
							</tr>
							<tr>
								<td style="width:8%; text-align:right;"><span>Mod.</span></td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_int_mod" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_ref_mod" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_tech_mod" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_cool_mod" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_attr_mod" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_luck_mod" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_ma_mod" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_body_mod" style="width:50%;text-align:center;"/>]</td>
								<td style="width:10%; text-align:center;">[<input type="text" value=0 maxlength=2 name="attr_emp_mod" style="width:50%;text-align:center;"/>]</td>
								<td colspan="3">

							</tr>
						</table>
					</td>
					<td style="width:49%;">
						<table style="width:90%;margin:0 auto 0 auto;vertical-align:top;">
							<tr>
								<td style="width:8%;text-align:right;">Wounds&nbsp;</td>
								<td style="width:15%;"><input type="number" style="width:100%;text-align:center;" name="attr_wounds" value="0" ></td>
								<td style="width:20%;text-align:right;">&nbsp;[<span name="attr_woundstate" ></span>]</td>
								<td>
									<button type="roll" value="&amp;{template:save}{{name=@{character_name}}}{{saveStunRoll=[[1d10!cf<1]]}}{{rangeStun=[[@{stunSave}+?{mod.|0}]]}}{{saveDeathRoll=[[1d10!cf<1]]}}{{rangeDeath=[[@{deathSave}+?{mod.|0}]]}}{{mod=?{mod.|0}}}'"><label class="labelbutton" style="text-align:center">Save</label></button>
								</td>
							</tr>
							<tr>
								<td colspan="4">
									<input type="hidden" name="attr_stunSave" value="0"><input type="hidden" name="attr_deathSave" value="0">
									<span name="attr_penaltytext" ></span>
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
			<table style="font-size:11.5px;">
				<tr style="font-size:11.5px;">
					<td style="width:8%; text-align:right;">&nbsp;</td>
					<td style="text-align:right;">Rep&nbsp;<input type="text" name="attr_rep" value="0" style="width:28%;" /></td>
					<td colspan="4" style="width:80%;text-align:left;">&nbsp;<span name="attr_repStatus" ></span></td>
				</tr>
				<tr>
					<td style="width:8%; text-align:right;">&nbsp;</td>
					<td style="width:15%; text-align:left;">Run&nbsp;[<span name="attr_run" ></span>m]</td>
					<td style="width:15%; text-align:left;">Leap&nbsp;[<span name="attr_leap" ></span>m]</td>
					<td style="width:15%; text-align:left;">Lift&nbsp;[<span name="attr_lift" ></span>kg]</td>
					<td style="width:15%; text-align:left;">BTM&nbsp;[<span name="attr_btm" ></span>]</td>
					<td style="width:15%; text-align:left;">Humanity&nbsp;[<span name="attr_hum" ></span>]</td>
				</tr>
			</table>
		</div>

		<span style="width:98%;float:left;margin:20px auto 0 auto;">
			<!-- PAGE SELECTOR MENU -->
			<input type="radio" class="sel_skills" value="skills" name="attr_pageselect" checked><span class="label_skills">Skills</span>
			<input type="radio" class="sel_combat" value="combat" name="attr_pageselect" ><span class="label_combat">Combat</span>
			<input type="radio" class="sel_cyberware" value="cyberware" name="attr_pageselect" ><span class="label_cyberware">Cyberware</span>
			<input type="radio" class="sel_cyberdeck" value="cyberdeck" name="attr_pageselect" ><span class="label_cyberdeck">Cyberdeck</span>
			<input type="radio" class="sel_gear" value="gear" name="attr_pageselect" ><span class="label_gear">Gear</span>
			<input type="radio" class="sel_notes" value="journal" name="attr_pageselect" ><span class="label_notes">Journal</span>
			<input type="radio" class="sel_lifepath" value="lifepath" name="attr_pageselect" ><span class="label_lifepath">Lifepath</span>
			
			<div class="page_tab page_skills">
				<h5 style="display:block;width:100%;text-align:center;margin:20px 0 5px 0;font-size:15px;">- Skills -</h5>
				<table style="width:98%;color:#00ffcc; background-color:black;margin:10px auto 0 auto;" >
					<tr>
						<td colspan=3>
							<div style="width:100%:">
								<span style="width:14%;float:left;text-align:right;font-weight:bold;font-style:italic;font-size:11.5px;">Special Ability&nbsp;</span>
								<select name="attr_special_ability_name" style="width:35%;">
									<option value="Charismatic Leadership">Charismatic Leadership</option>
									<option value="Combat Sense">Combat Sense</option>
									<option value="Interface">Interface</option>
									<option value="Authority">Authority</option>
									<option value="Resource">Resource</option>
									<option value="Streetdeal">Streetdeal</option>
									<option value="Jury Rig">Jury Rig</option>
									<option value="Medical tech">Medical tech</option>
									<option value="Family">Family</option>
									<option value="Credibility">Credibility</option>
								</select>
								[<input type=number maxlength="2" name="attr_special_ability_value" style="width:10%;"/>]
								<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=@{special_ability_name}}} {{result=[[1d10!cf<1 + @{specail_ability_value} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{specail_ability_value}]]}}" ></button>
							</div>
						</td>
					</tr>
					<tr>
					<td style="width:30%;vertical-align:text-top;">
						<table style="font-size:11.5px;color:#00ffcc;width:100%;">
							<tr style="font-style:italic;" >
								<td width="49%"><span>Skill</span></td>
								<td width="20%"><span>Value</span></td>
								<td width="20%"><span>Mod.</span></td>
								<td width="10%"><span></span></td>
							</tr>
							<tr><td colspan=4><span style="width:100%; font-weight:bold;">Attractiveness</span></td></tr>
							<tr>
								<td width="49%"><span>Personal Grooming</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_personalgrooming" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_personalgrooming_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Personal Grooming}} {{result=[[1d10!cf<1 + @{personalgrooming} + @{personalgrooming_mod}+ @{attr} + @{attr_mod} - @{attr_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{personalgrooming}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Wardrobe &amp; Style</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_wardrobestyle" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_wardrobestyle_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Wardrobe and Style}} {{result=[[1d10!cf<1 + @{wardrobestyle} + @{wardrobestyle_mod}+ @{attr} + @{attr_mod} - @{attr_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{wardrobestyle}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr><td colspan=4><span style="width:100%; font-weight:bold;">Body</span></td></tr>
							<tr>
								<td width="49%"><span>Endurance</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_endurance" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_endurance_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Endurance}} {{result=[[1d10!cf<1 + @{endurance} + @{endurance_mod} + @{body} + @{body_mod} - @{body_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{endurance}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Strength Feat</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_strengthfeat" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_strengthfeat_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Strength Feat}} {{result=[[1d10!cf<1 + @{strengthfeat} + @{strengthfeat_mod} + @{body} + @{body_mod} - @{body_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{strengthfeat}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Swimming</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_swimming" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_swimming_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Swimming}} {{result=[[1d10!cf<1 + @{swimming} + @{swimming_mod}+ @{body} + @{body_mod} - @{body_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{swimming}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>					
							<tr><td colspan=4><span style="width:100%; font-weight:bold;">Cool/Will</span></td></tr>
							<tr>
								<td width="49%"><span>Interrogation</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_interrogation" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_interrogation_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Interrogation}} {{result=[[1d10!cf<1 + @{interrogation} + @{interrogation_mod}+ @{cool} + @{cool_mod} - @{cool_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{interrogation}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Intimidation</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_intimidation" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_intimidation_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Intimidation}} {{result=[[1d10!cf<1 + @{intimidation} + @{intimidation_mod}+ @{cool} + @{cool_mod} - @{cool_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{intimidation}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Oratory</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_oratory" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_oratory_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Oratory}} {{result=[[1d10!cf<1 + @{oratory} + @{oratory_mod}+ @{cool} + @{cool_mod} - @{cool_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{oratory}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Resist Torture/ Drugs</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_resisttorturedrugs" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_resisttorturedrugs_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Resist Torture/ Drugs}} {{result=[[1d10!cf<1 + @{resisttorturedrugs} + @{resisttorturedrugs_mod}+ @{cool} + @{cool_mod} - @{cool_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{resisttorturedrugs}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Streetwise</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_streetwise" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_streetwise_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Streetwises}} {{result=[[1d10!cf<1 + @{streetwise} + @{streetwise_mod}+ @{cool} + @{cool_mod} - @{cool_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{streetwise}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr><td colspan=4><span style="width:100%; font-weight:bold;">Tech</span></td></tr>
							<tr>
								<td width="49%"><span>Aero Tech</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_aerotech" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_aerotech_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Aero Tech}} {{result=[[1d10!cf<1 + @{aerotech} + @{aerotech_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{aerotech}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>AV Tech</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_avtech" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_avtech_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=AV Tech}} {{result=[[1d10!cf<1 + @{avtech} + @{avtech_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{avtech}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Basic Tech</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_basictech" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_basictech_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Basic Tech}} {{result=[[1d10!cf<1 + @{basictech} + @{basictech_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{basictech}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Cryotank Ops</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_cryotankops" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_cryotankops_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Cryotank Ops}} {{result=[[1d10!cf<1 + @{cryotankops} + @{avtech_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{avtech}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Cyberdeck Design</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_cyberdeckdesign" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_cyberdeckdesign_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Cyberdek Design}} {{result=[[1d10!cf<1 + @{cyberdeckdesign} + @{cyberdeckdesign_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{cyberdeckdesign}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Cybertech</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_cybertech" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_cybertech_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Cybertech}} {{result=[[1d10!cf<1 + @{cybertech} + @{cybertech_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{cybertech}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Demolitions</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_demolitions" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_demolitions_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Demolitions}} {{result=[[1d10!cf<1 + @{demolitions} + @{demolitions_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{demolitions}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Disguise</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_disguise" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_disguise_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Disguise}} {{result=[[1d10!cf<1 + @{disguise} + @{disguise_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{disguise}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Electronics</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_electronics" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_electronics_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Electronics}} {{result=[[1d10!cf<1 + @{electronics} + @{electronics_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{electronics}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Elect. Security</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_electsecurity" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_electsecurity_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Electronic Security}} {{result=[[1d10!cf<1 + @{electsecurity} + @{electsecurity_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{electsecurity}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>First Aid</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_firstaid" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_firstaid_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=First Aid}} {{result=[[1d10!cf<1 + @{firstaid} + @{firstaid_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{firstaid}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Forgery</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_forgery" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_forgery_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Forgery}} {{result=[[1d10!cf<1 + @{forgery} + @{forgery_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{forgery}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Gyro Tech</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_gyrotech" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_gyrotech_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Gyro Tech}} {{result=[[1d10!cf<1 + @{gyrotech} + @{gyrotech_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{gyrotecxh}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Paint/ Draw</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_paintdraw" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_paintdraw_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Paint - Draw}} {{result=[[1d10!cf<1 + @{paintdraw} + @{paintdraw_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{[aintdraw}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Photo &amp; Film</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_photofilm" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_photofilm_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Photography}} {{result=[[1d10!cf<1 + @{photo} + @{photo_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{photo}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Pharma.</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_pharma" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_pharma_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Pharmacology}} {{result=[[1d10!cf<1 + @{pharma} + @{pharma_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{pharma}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Pick Lock</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_picklock" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_picklock_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Pick Lock}} {{result=[[1d10!cf<1 + @{picklock} + @{picklock_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{picklock}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Pick Pocket</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_pickpocket" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_pickpocket_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Pick Pocket}} {{result=[[1d10!cf<1 + @{pickpocket} + @{pickpocket_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{pickpocket}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Play Instrument</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_playinstrument" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_playinstrument_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Play Instrument}} {{result=[[1d10!cf<1 + @{playinstrument} + @{playinstr_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{playinstrument}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Weaponsmith</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_weaponsmith" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_weaponsmith_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Weaponsmith}} {{result=[[1d10!cf<1 + @{weaponsmith} + @{weaponsmith_mod}+ @{tech} + @{tech_mod} - @{tech_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{weaponsmith}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
						</table>
					</td>
					<td style="width:30%;vertical-align:text-top;">
						<table style="font-size:11.5px;color:#00ffcc;width:100%;" >
							<tr style="font-style:italic;" >
								<td width="49%"><span>Skill</span></td>
								<td width="20%"><span>Value</span></td>
								<td width="20%"><span>Mod.</span></td>
								<td width="10%"><span></span></td>
							</tr>
					
							<tr><td colspan=4><span style="width:100%; font-weight:bold;">Intelligence</span></td></tr>
							<tr>
								<td width="49%"><span>Accounting</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_accounting" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_accounting_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Accounting}} {{result=[[1d10!cf<1 + @{accounting} + @{accounting_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{accounting}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Anthropology</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_anthropology" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_anthropology_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Anthropology}} {{result=[[1d10!cf<1 + @{anthropology} + @{anthropology_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{anthropology}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Awareness</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_awareness" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_awareness_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Awareness}} {{result=[[1d10!cf<1 + @{awareness} + @{awareness_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{awareness}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Biology</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_biology" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_biology_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Biology}} {{result=[[1d10!cf<1 + @{biology} + @{biology_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{biology}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Botany</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_botany" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_botany_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Botany}} {{result=[[1d10!cf<1 + @{botany} + @{botany_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{botany}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Chemistry</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_chemistry" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_chemistry_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Chemistry}} {{result=[[1d10!cf<1 + @{chemistry} + @{chemistry_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{accounting}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Composition</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_composition" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_composition_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Composition}} {{result=[[1d10!cf<1 + @{composition} + @{composition_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{composition}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Diagnose Illness</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_diagnose" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_diagnose_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Diagnose Illness}} {{result=[[1d10!cf<1 + @{diagnose} + @{diagnose_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{diagnose}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Education</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_education" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_education_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Education}} {{result=[[1d10!cf<1 + @{education} + @{education_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{education}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Expert</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_expert" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_expert_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Expert}} {{result=[[1d10!cf<1 + @{expert} + @{expert_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{expert}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Gamble</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_gamble" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_gamble_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Gamble}} {{result=[[1d10!cf<1 + @{gamble} + @{gamble_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{gamble}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Geology</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_geology" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_geology_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Geology}} {{result=[[1d10!cf<1 + @{geology} + @{geology_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{geology}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Hide/Evade</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_hideevade" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_hideevade_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Hide - Evade}} {{result=[[1d10!cf<1 + @{hideevade} + @{hideevade_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{hideevade}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>History</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_history" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_history_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=History}} {{result=[[1d10!cf<1 + @{history} + @{history_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{history}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Language</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_language" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_language_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Language}} {{result=[[1d10!cf<1 + @{language} + @{language_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{language}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Library Search</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_librarysearch" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_librarysearch_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Library Search}} {{result=[[1d10!cf<1 + @{librarysearch} + @{librarysearch_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{librarysearch}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Mathematics</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_mathematics" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_mathematics_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Mathematics}} {{result=[[1d10!cf<1 + @{mathematics} + @{mathematics_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{mathematics}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Physics</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_physics" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_physics_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Physics}} {{result=[[1d10!cf<1 + @{physics} + @{physics_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{physics}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Programming</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_programming" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_programming_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Programming}} {{result=[[1d10!cf<1 + @{programming} + @{programming_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{programming}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Shadow/ Track</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_shadowtrack" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_shadowtrack_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Shadow - Track}} {{result=[[1d10!cf<1 + @{shadowtrack} + @{shadowtrack_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{shadowtrack}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Stock Market</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_stockmarket" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_stockmarket_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Stock Market}} {{result=[[1d10!cf<1 + @{stockmarket} + @{stockmarket_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{stockmarket}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>System Knowledge</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_systemknowledge" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_systemknowledge_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=System Knowledge}} {{result=[[1d10!cf<1 + @{systemknowledge} + @{systemknowledge_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{systemknowledge}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Teaching</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_teaching" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_teaching_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Teaching}} {{result=[[1d10!cf<1 + @{teaching} + @{teaching_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{teaching}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Wilderness Survival</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_wildernesssurvival" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_wildernesssurvival_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Wilderness Survival}} {{result=[[1d10!cf<1 + @{wildernesssurvival} + @{wildernesssurvival_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{wildernesssurvival}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Zoology</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_zoology" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_zoology_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Zoology}} {{result=[[1d10!cf<1 + @{zoology} + @{zoology_mod}+ @{int} + @{int_mod} - @{int_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{zoology}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
						</table>
					</td>
					<td style="width:30%;vertical-align:text-top;">
						<table style="font-size:11.5px;color:#00ffcc;width:100%;">
							<tr style="font-style:italic;" >
								<td width="49%"><span>Skill</span></td>
								<td width="20%"><span>Value</span></td>
								<td width="20%"><span>Mod.</span></td>
								<td width="10%"><span></span></td>
							</tr>
							<tr><td colspan=4><span style="width:100%; font-weight:bold;">Reflexes</span></td></tr>
							<tr>
								<td width="49%"><span>Archery</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_archery" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_archery_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Archery}} {{result=[[1d10!cf<1 + @{archery} + @{archery_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{archery}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Athletics</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_athletics" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_athletics_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Athletics}} {{result=[[1d10!cf<1 + @{athletics} + @{athletics_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{athletics}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Brawling</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_brawling" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_brawling_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Brawling}} {{result=[[1d10!cf<1 + @{brawling} + @{brawling_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{brawling}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr><td colspan=4 style="font-style:italic;font-size:10px;">Martial Arts listed on Combat tab</td></tr>
							<tr>
								<td width="49%"><span>Dance</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_dance" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_dance_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Dance}} {{result=[[1d10!cf<1 + @{dance} + @{dance_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{dance}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Dodge &amp; Escape</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_dodgeescape" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_dodgeescape_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Dodge - Escape}} {{result=[[1d10!cf<1 + @{dodgeescape} + @{dodgeescape_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{dodgeescape}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Driving</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_driving" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_driving_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Driving}} {{result=[[1d10!cf<1 + @{driving} + @{driving_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{driving}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Fencing</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_fencing" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_fencing_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Fencing}} {{result=[[1d10!cf<1 + @{fencing} + @{fencing_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{fencing}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Handgun</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_handgun" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_handgun_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Handgun}} {{result=[[1d10!cf<1 + @{handgun} + @{handgun_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{handgun}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Heavy Weapons</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_heavyweapons" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_heavyweapons_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Heavy Weapons}} {{result=[[1d10!cf<1 + @{heavyweapons} + @{heavyweapons_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{heavyweapons}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Melee</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_melee" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_melee_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Melee}} {{result=[[1d10!cf<1 + @{melee} + @{melee_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{melee}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Motorcycle</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_motorcycle" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_motorcycle_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Motorcycle}} {{result=[[1d10!cf<1 + @{motorcycle} + @{motorcycle_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{motorcycle}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Hvy. Machinery</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_hvymachinery" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_hvymachinery_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Heavy Machinery}} {{result=[[1d10!cf<1 + @{hvymachinery} + @{hvymachinery_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{hvymachinery}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Pilot (Gyro)</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_pilotgyro" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_pilotgyro_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Pilot (Gyro)}} {{result=[[1d10!cf<1 + @{pilotgyro} + @{pilotgyro_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{pilotgyro}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Pilot (Fixed Wing)</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_pilotfixedwing" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_pilotfixedwing_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Pilot (Fixed Wing)}} {{result=[[1d10!cf<1 + @{pilotfixedwing} + @{pilotfixedwing_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{pilotfixedwing}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Pilot (VT)</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_pilotvt" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_pilotvt_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Pilot (VT)}} {{result=[[1d10!cf<1 + @{pilotvt} + @{pilotvt_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{pilotvt}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Rifle</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_rifle" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_rifle_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Rifle}} {{result=[[1d10!cf<1 + @{rifle} + @{rifle_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{rifle}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Stealth</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_stealth" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_stealth_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Stealth}} {{result=[[1d10!cf<1 + @{stealth} + @{stealth_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{stealth}]]}}">
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>SMG</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_smg" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_smg_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=SMG}} {{result=[[1d10!cf<1 + @{smg} + @{smg_mod}+ @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{smg}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr><td colspan=4><span style="width:100%; font-weight:bold;">Empathy</span></td></tr>
							<tr>
								<td width="49%"><span>Human Perception</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_humanperception" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_humanperception_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Human Perception}} {{result=[[1d10!cf<1 + @{humanperception} + @{humanperception_mod}+ @{emp} + @{emp_mod} - @{emp_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{humanperception}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Interview</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_interview" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_interview_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Interview}} {{result=[[1d10!cf<1 + @{interview} + @{interview_mod}+ @{emp} + @{emp_mod} - @{emp_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{interview}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Leadership</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_leadership" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_leadership_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Leadership}} {{result=[[1d10!cf<1 + @{leadership} + @{leadership_mod}+ @{emp} + @{emp_mod} - @{emp_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{leadership}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Persuasion/ Fast Talk</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_persuasion" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_persuasion_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Persuasion/ Fast Talk}} {{result=[[1d10!cf<1 + @{persuasion} + @{persuasion_mod}+ @{emp} + @{emp_mod} - @{emp_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{persuasion}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Perform</span></td>
								<td width="20%">[<input type=number maxlength="2" name="attr_perform" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number maxlength="2" name="attr_perform_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Perform}} {{result=[[1d10!cf<1 + @{perform} + @{perform_mod}+ @{emp} + @{emp_mod} - @{emp_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{perform}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Seduction</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_seduction" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_seduction_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Seduction}} {{result=[[1d10!cf<1 + @{seduction} + @{seduction_mod}+ @{emp} + @{emp_mod} - @{emp_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{seduction}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
							<tr>
								<td width="49%"><span>Social</span></td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_social" style="width:60%;"/>]</td>
								<td width="20%">[<input type=number value=0 maxlength="2" name="attr_social_mod" style="width:60%;"/>]</td>
								<td width="10%">
									<button type="roll" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=Social}} {{result=[[1d10!cf<1 + @{Social} + @{social_mod}+ @{emp} + @{emp_mod} - @{emp_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{social}]]}}">
										<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
									</button>
								</td>
							</tr>
						</table>
					</td>			
					</tr>
				</table>
			</div> <!-- SKILLS PAGE -->

			<!-- COMBAT PAGE -->
			<div class="page_tab page_combat">
				<h5 style="display:block;width:100%;text-align:center;margin:20px 0 5px 0;font-size:15px;">- Combat -</h5>	
				<!-- ARMOUR SUMMARY -->
				<div style="width:90%;margin:0 auto 0 auto;">
					<table style="font-size:10.5px;color:#00ffcc;width:100%;margin0 auto 0 auto;">
						<tr><td colspan="7">
							<h5 style="display:block;width:100%;text-align:center;margin:0 0 5px 0;font-size:11.5px;">Armour</h5>
						</td>
						<td width=1%>&nbsp;</td>
						<td colspan="7">
							<h5 style="display:block;width:100%;text-align:center;margin:0 0 5px 0;font-size:11.5px;">Hit Locations</h5>
						</td></tr>
						<tr style="width:99%;font-style:italic;">
							<td><span style="width:7%;text-align:center;">(Face)</span></td>
							<td><span style="width:7%;text-align:center;">1: Head</span></td>
							<td><span style="width:7%;text-align:center;">2-4: Torso</span></td>
							<td><span style="width:7%;text-align:center;">5: R.Arm</span></td>
							<td><span style="width:7%;text-align:center;">6: L.Arm</span></td>
							<td><span style="width:7%;text-align:center;">7-8: R.leg</span></td>
							<td><span style="width:7%;text-align:center;">9-0: L.Leg</span></td>
							<td colspan="8" >&nbsp;</td>
						</tr>
						<tr style="margin:4px 0 2px 0;">
							<td colspan="5">
								<input type="checkbox" class="active-layer" name="attr_layer_1" value="1"/>
								<input type="text" name="attr_armour_1" placeholder="Layer 1"/>
							</td>
							<td colspan="2"><input type="number" name="attr_enc_1" placeholder="enc" style="width:49%"/></td>
							<td width=1%>&nbsp;</td>
							<td><span style="width:7%;text-align:center;">(Face)</span></td>
							<td><span style="width:7%;text-align:center;">1: Head</span></td>
							<td><span style="width:7%;text-align:center;">2-4: Torso</span></td>
							<td><span style="width:7%;text-align:center;">5: R.Arm</span></td>
							<td><span style="width:7%;text-align:center;">6: L.Arm</span></td>
							<td><span style="width:7%;text-align:center;">7-8: R.leg</span></td>
							<td><span style="width:7%;text-align:center;">9-0: L.Leg</span></td>
						</tr>
						<tr style="margin:1px 0 2px 0;">
							<td style="width:7%;" ><input type="number" name="attr_face_1" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_head_1" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_torso_1" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_rArm_1" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_lArm_1" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_rLeg_1" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_lLeg_1" value="0" style="text-align:center;width:100%;"/></td>
							<td width=2%>&nbsp;</td>
							<td style="width:7%;" ><input type="number" readonly name="attr_face_sp" value="0" style="text-align:center;width:100%;" /> </td>
							<td style="width:7%;" ><input type="number" readonly name="attr_head_sp" value="0" style="text-align:center;width:100%;" /> </td>
							<td style="width:7%;" ><input type="number" readonly name="attr_torso_sp" value="0" style="text-align:center;width:100%;" /> </td>
							<td style="width:7%;" ><input type="number" readonly name="attr_rarm_sp" value="0" style="text-align:center;width:100%;" /> </td>
							<td style="width:7%;" ><input type="number" readonly name="attr_larm_sp" value="0" style="text-align:center;width:100%;" /> </td>
							<td style="width:7%;" ><input type="number" readonly name="attr_rleg_sp" value="0" style="text-align:center;width:100%;" /></td>
							<td style="width:7%;" ><input type="number" readonly name="attr_lleg_sp" value="0" style="text-align:center;width:100%;" /> </td>
						</tr>
						<tr style="margin:4px 0 2px 0;">
							<td colspan="5">
								<input type="checkbox" class="active-layer" name="attr_layer_2" value="1"/>
								<input type="text" name="attr_armour_2" placeholder="Layer 2"/>
							</td>
							<td colspan="2"><input type="number" name="attr_enc_2" placeholder="enc" style="width:49%"/></td>
							<td width=1%>&nbsp;</td>
							<td colspan="2">Skinweave : </td>
							<td colspan="2"><i>Torso </i><input name="attr_skinweave" value="1" type="checkbox"/></td>
							<td colspan="3"><i>Legs </i><input name="attr_skinweaveLegs" value="1" type="checkbox"/></td>
						</tr>
						<tr style="margin:1px 0 2px 0;">
							<td style="width:7%;" ><input type="number" name="attr_face_2" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_head_2" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_torso_2" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_rArm_2" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_lArm_2" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_rLeg_2" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_lLeg_2" value="0" style="text-align:center;width:100%;"/></td>
							<td colspan="8" >&nbsp;</td>
						</tr>
						<tr style="margin:4px 0 2px 0;">
							<td colspan="5">
								<input type="checkbox" class="active-layer" name="attr_layer_3" value="1"/>
								<input type="text" name="attr_armour_3" placeholder="Layer 3"/>
							</td>
							<td colspan="2"><input type="number" name="attr_enc_3" placeholder="enc" style="width:49%"/></td>
							<td colspan="8" >&nbsp;</td>
						</tr>
						<tr style="margin:1px 0 2px 0;">
							<td style="width:7%;" ><input type="number" name="attr_face_3" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_head_3" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_torso_3" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_rArm_3" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_lArm_3" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_rLeg_3" value="0" style="text-align:center;width:100%;"/></td>
							<td style="width:7%;" ><input type="number" name="attr_lLeg_3" value="0" style="text-align:center;width:100%;"/></td>
							<td colspan="8" >&nbsp;</td>
						</tr>
					</table>
				</div>
				<!-- INITIATIVE BLOCK -->
				<h5 style="display:block;width:100%;text-align:left;margin:0 0 5px 0;font-size:11.5px;">Initiative</h5>
				<table style="color:#00ffcc;font-size:12px;">
					<tr style="width:98%" >
						<td style="width:14%; text-align:right;">Bonuses&nbsp;</td>
						<td style="width:7%;">
							<input type="number" name="attr_initiativebonuses" value="0" />
							<input type="hidden" name="attr_initiativescript" value="" />
						</td>
						<td><button class="dieRoll" type="roll" value="@{initiativescript}" ><label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label></button></td>
					</tr>
				</table>
				
				<table style="width:100%;color:#00ffcc;font-family:verdana;" >
				<tr><td>
				<!-- GUNS COLLECTION -->
					<h4 style="display:block;width:100%;margin:10px	0 5px 0;font-size:13px;text-align:center;">Ranged</h4>
					<div style="width:95%;margin:10px auto 10px auto;">
						<fieldset class="repeating_firearms">
							<input type="text" name="attr_wp-name" placeholder="Weapon name" style="width:27%;"/>
							<select name="attr_wp-type" style="width:15%;">
								<option value="@{handgun}">P</option>
								<option value="@{rifle}">RIF</option>
								<option value="@{smg}">SMG</option>
								<option value="@{rifle}">SHT</option>
								<option value="@{hvyweapons}">HVY</option>
								<option value="@{hvyweapons}">EXO</option>
							</select>
							<input type="number" name="attr_wp-wa" placeholder="WA" style="width:5%;" />
							<input type="text" name="attr_wp-ammo" placeholder="Ammo" style="width:12%;" />
							<input type="text" name="attr_wp-dmg" placeholder="2d6+1" style="width:10%;"/>
							<input type="text" name="attr_wp-rof" placeholder="ROF: .../..."style="width:10%;"/>
							<input type="text" name="attr_wp-range" placeholder="Range" style="width:10%;"/>
							<button type=roll value="&amp;{template:attack}{{name=@{character_name}}}{{weapon={@{wp-name}: @{wp-ammo}}} {{dmg=[[@{wp-dmg}]]}} {{result=[[1d10!cf<1 + @{wp-type} + @{wp-wa} + @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{wp-type}]]}}{{loc=[[1d10]]}}{{dmgCrt=[[1d10]]}}">
								<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
							</button>
							<input type="number" name="attr_wp-ammo-load" value="0" style="visibility: hidden;" style="width:15%;"/>
						</fieldset>
					</div>
				</td></tr>
				
				<!-- MELEE WEAPONS -->
				<tr><td>
					<h4 style="display:block;width:100%;text-align:left;margin:0 0 5px 0;font-size:13px;text-align:center;">Melee Weapons</h4>
					<div style="width:95%;margin:10px auto 10px auto;">
						<fieldset class="repeating_meleeweapons">
							<input type="text" name="attr_mel-name" placeholder="Weapon name" style="width:40%;"/>
							<input type="text" name="attr_mel-wa" placeholder="WA" style="width:5%;" />
							<input type="text" name="attr_mel-dmg" placeholder="2d6+1" style="width:10%;"/>
							<input type="text" name="attr_mel-range" placeholder="Range" style="width:10%;"/>
							<input type="text" name="attr_mel-special" placeholder="Qualities" style="width:27%;"/>
							<button type=roll value="&amp;{template:attack}{{name=@{character_name}}}{{weapon=@{mel-name}}} {{dmg=[[@{mel-dmg}]]}} {{result=[[1d10!cf<1 + @{melee} + @{mel-wa} + @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{melee}]]}}{{loc=[[1d10]]}}{{dmgCrt=[[1d10]]}}">
								<label class="labelbutton" style="text-align:center; font-family:Pictos;">r</label>
							</button>			
						</fieldset>
					</div>
				</td></tr>

				<!-- MARTIAL ARTS -->
				<tr><td>
					<h4 style="display:block;width:100%;margin:0 0 5px 0;font-size:13px;text-align:center;">Martial Arts</h4>
					<div style="width:95%;margin:10px auto 10px auto;">
						<fieldset class="repeating_martialarts">
							<table style="font-size:11.5px;color:#00ffcc;width:80%;margin:0 auto 0 auto;"> 
								<tr>
									<td colspan="6">
										<input type=text name="attr_martialartname" style="width:100%;" placeholder="Martial Art Name" >
									</td>
									<td colspan="4">
										<input type=number value=0 name="attr_martialart" style="width:20%;">
									</td>
								</tr>
								<tr>
									<td width="8%">
										<button type=roll style="width:45%;" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=@{martialartname} - Strike}} {{result=[[1d10!cf<1 + @{martialart}+ @{ma_strike} + @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{martialart}]]}}">
											<label class="smalllabelbutton" style="text-align:center; font-family:inherit;;">Strike</label>
										</button>
									</td>
									<td width="12%">
										<input type="number" value=0 name="attr_ma_strike" style="width:100%;" />
									</td>
									<td width="8%">
										<button type=roll style="width:45%;" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=@{martialartname} - Kick}} {{result=[[1d10!cf<1 + @{martialart}+ @{ma_kick} + @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{martialart}]]}}">
											<label class="smalllabelbutton" style="text-align:center; font-family:inherit;">Kick</label>
										</button>
									</td>
									<td width="12%">
										<input type="number" value=0 name="attr_ma_kick" style="width:100%;" />
									</td>
									<td width="8%">
										<button type=roll style="width:45%;" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=@{martialartname} - Block}} {{result=[[1d10!cf<1 + @{martialart}+ @{ma_block} + @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{martialart}]]}}">
											<label class="smalllabelbutton" style="text-align:center; font-family:inherit;">Block</label>
										</button>
									</td>
									<td width="12%">
										<input type="number" value=0 name="attr_ma_block" style="width:100%;" />
									</td>
									<td width="8%">
										<button type=roll style="width:45%;" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=@{martialartname} - Dodge}} {{result=[[1d10!cf<1 + @{martialart}+ @{ma_dodge} + @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{martialart}]]}}">
											<label class="smalllabelbutton" style="text-align:center; font-family:inherit;">Dodge</label>
										</button>
									</td>
									<td width="12%">
										<input type="number" value=0 name="attr_ma_strike"style="width:100%;" />
									</td>
									<td width="8%">
										<button type=roll style="width:45%;" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=@{martialartname} - Throw}} {{result=[[1d10!cf<1 + @{martialart}+ @{ma_throw} + @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{martialart}]]}}">
											<label class="smalllabelbutton" style="text-align:center; font-family:inherit;">Throw</label>
										</button>
									</td>
									<td width="12%">
										<input type="number" value=0 name="attr_ma_throw" style="width:100%;" />
									</td>
								</tr>
								<tr>
									<td width="8%">
										<button type=roll style="width:45%;" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=@{martialartname} - Bold}} {{result=[[1d10!cf<1 + @{martialart}+ @{ma_hold} + @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{martialart}]]}}">
											<label class="smalllabelbutton" style="text-align:center; font-family:inherit;">Hold</label>
										</button>
									</td>
									<td width="12%">
										<input type="number" value=0 name="attr_ma_hold" style="width:100%;" />
									</td>
									<td width="8%">
										<button type=roll style="width:45%;" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=@{martialartname} - Escape}} {{result=[[1d10!cf<1 + @{martialart}+ @{ma_escape} + @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{martialart}]]}}">
											<label class="smalllabelbutton" style="text-align:center; font-family:inherit;">Escape</label>
										</button>
									</td>
									<td width="12%">
										<input type="number" value=0 name="attr_ma_escape" style="width:100%;" />
									</td>
									<td width="8%">
										<button type=roll style="width:45%;" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=@{martialartname} - Choke}} {{result=[[1d10!cf<1 + @{martialart}+ @{ma_choke} + @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{martialart}]]}}">
											<label class="smalllabelbutton" style="text-align:center; font-family:inherit;">Choke</label>
										</button>
									</td>
									<td width="12%">
										<input type="number" value=0 name="attr_ma_choke" style="width:100%;" />
									</td>
									<td width="8%">
										<button type=roll style="width:45%;" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=@{martialartname} - Sweep}} {{result=[[1d10!cf<1 + @{martialart}+ @{ma_sweep} + @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{martialart}]]}}">
											<label class="smalllabelbutton" style="text-align:center; font-family:inherit;">Sweep</label>
										</button>
									</td>
									<td width="12%">
										<input type="number" value=0 name="attr_ma_sweep" style="width:100%;" />
									</td>
									<td width="8%">
										<button type=roll style="width:45%;" value="&amp;{template:skill}{{name=@{character_name}}}{{skillname=@{martialartname} - Grapple}} {{result=[[1d10!cf<1 + @{martialart}+ @{ma_grapple} + @{ref} + @{ref_mod} - @{ref_penalty} + ?{mod.|0}]] }}{{mod=?{mod.|0}}}{{fumble=[[{1d10}<@{martialart}]]}}">
											<label class="smalllabelbutton" style="text-align:center; font-family:inherit;">Grapple</label>
										</button>
									</td>
									<td width="12%">
										<input type="number" value=0 name="attr_ma_grapple" style="width:100%;" />
									</td>
								</tr>
							</table>
						</fieldset>
					</div>
				</td></tr>
				</table>
			</div>
		
			<!-- CYBERWARE PAGE -->
			<div class="page_tab page_cyberware">
				<h5 style="display:block;width:100%;text-align:center;margin:20px 0 5px 0;font-size:15px;">- Cyberware -</h5>
				<input type="hidden" value="0" name="attr_totalcyb" />
				<div style="width:90%;margin:10px auto 10px auto;font-size:11.5px;">
					<fieldset class="repeating_cyberware">
						<input type="text" Placeholder="Cyberware" name="attr_cyberwarename" style="width:74%;" >
						<select name="attr_cyberwaretype" style="width:15%;">
							<option value="cyb_cosmetic">Fashionware</option>
							<option value="cyb_neural">Neuralware</option>
							<option value="cyb_implants">Implants</option>
							<option value="cyb_bioware">bioware</option>	
							<option value="cyb_weapons">Cyberware</option>
							<option value="cyb_optics">Cyberoptics</option>						
						</select>
						<input type="number" value="0" Placeholder="Hum." name="attr_cyberhumanitycost" style="width:8%;" >
						<br />
						<textarea name="attr_cyberdescription" style="margin:5px auto 0 auto;width:98%" >Description</textarea>
					</fieldset>
				</div>
			</div> <!-- CYBERWARE PAGE -->
		
			<!-- CYBERDECK PAGE -->
			<div class="page_tab page_cyberdeck"  >
				<!-- GUNS COLUMN -->
				<div style="width:90%;margin:0 auto 0 auto;" >
					<h5 style="display:block;width:100%;text-align:center;margin:20px 0 5px 0;font-size:15px;">- Cyberdeck -</h5>
					<span>Model&nbsp;</span><input type="text" name="attr_cyberdeckmodel" style="width:40%;" />	
					<span>No. of CPU&nbsp;</span><input type="number" name="attr_cyberdeckcpu" style="width:15%;" />
					<span>Cost&nbsp;</span><input type="number" name="attr_cyberdeckcpu" style="width:15%;" /><br />
					<span>Type&nbsp;</span>
					<select name="attr_cyberdecktype">
						<option value="cybdeck_cellular">Cellular</option>
						<option value="cybdeck_portable">Portable</option>
						<option value="cybdeck_combat">Combat Deck</option>
						<option value="cybdeck_cyberlimb">Cyberlimb Deck</option>
						<option value="cybdeck_standard">Standard</option>
					</select><br />
					<span>Data Wall Str&nbsp;</span><input type="number" name="attr_cyberdeckdatawallstr" style="width:10%;" />
					<span>Code Gate Str&nbsp;</span><input type="number" name="attr_cyberdeckcodegatestr" style="width:10%;" />
					<span>Deck Speed&nbsp;</span><input type="number" name="attr_cyberdeckspeedstr" style="width:10%;" />
					<span>Memory&nbsp;</span><input type="number" name="attr_cyberdeckmemory" style="width:10%;" /><br />
					<span>Your Avatar&nbsp;</span><input type="text" name="attr_cyberdeckavatar" style="width:80%;" /><br />
				
					<h4 style="display:block;width:100%;text-align:left;margin:10px 0 5px 0;font-size:13px;text-align:center;">Programs</h4>
					<span style="width:61%;display:inline-block;" >Name&nbsp;</span><span style="width:10%;display:inline-block;" >MU</span><span style="width:10%;display:inline-block;" >STR</span><span style="width:10%;display:inline-block;" >Cost</span>
					<fieldset class="repeating_cyberdeckprograms">
						<input type="text" name="attr_programname" style="width:60%;" />
						<input type="number" name="attr_programmu" style="width:10%;" />
						<input type="number" name="attr_programstr" style="width:10%;" />
						<input type="number" name="attr_programcost" style="width:10%;" /> <!-- TBD: Text area description -->
					</fieldset>
				</div>
			</div>			
		
			<!-- GEAR PAGE -->
			<div class="page_tab page_gear">
				<div style="width:90%;margin:0 auto 0 auto;" >
				<h5 style="display:block;width:100%;text-align:center;margin:20px 0 5px 0;font-size:15px;">- Gear -</h5>
					<fieldset class="repeating_gear">
						<input type="text" style="width:98%;margin:0 auto 0 auto;" name="attr_gearname">
						<textarea style="width:98%;margin:5px auto 0 auto;" rows=4  name="attr_geardesc"></textarea>
						
					</fieldset>
				</div>
			</div> <!-- GEAR PAGE -->
			
			<!-- NOTES -->
			<div class="page_tab page_notes">
				<div style="width:90%;margin:0 auto 0 auto;" >
					<h5 style="display:block;width:100%;text-align:center;margin:20px 0 10px 0;font-size:15px;">- Journal -</h5>
					<h4 style="display:block;width:100%;text-align:center;margin:5px 0 5px 0;font-size:13px;">Contacts</h4>
					<fieldset class="repeating_contacts">
						<input type="text" style="width:98%;margin:0 auto 0 auto;" name="attr_contactname">
						<textarea style="width:98%;margin:5px auto 0 auto;" rows=5 name="attr_contactdesc"></textarea>
					</fieldset>

					<h4 style="display:block;width:100%;text-align:center;margin:10px 0 5px 0;font-size:13px;">Notes</h4>
					<fieldset class="repeating_notes">
						<textarea style="width:98%;" rows=4 name="attr_playernote"></textarea>
					</fieldset>

				</div>
			</div> <!-- NOTES PAGE -->
		
			<!-- LIFEPATH -->
			<div class="page_tab page_lifepath">
				<h5 style="display:block;width:100%;text-align:center;margin:20px 0 10px 0;font-size:15px;">- Lifepath -</h5>
        		<h5 style="width:100%;text-align:center;margin:0 0 5px 0;font-size:13px;">Style</h5>
        		<span style="width:14%;float:left;text-align:right;">Hair&nbsp;</span>
        		<span style="width:35%;float:left;text-align:right;"><input class="bioEdit" type="text" name="attr_hair" style="width:100%;"></span>
        		<span style="width:14%;float:left;text-align:right;">Eyes&nbsp;</span>
        		<span style="width:35%;float:left;text-align:right;"><input class="bioEdit" type="text" name="attr_eyes" style="width:100%;"></span>
        		
				<span style="width:14%;float:left;text-align:right;">Clothes&nbsp;</span>
        		<span style="width:84%;float:left;text-align:right;"><input class="bioEdit" type="text" name="attr_clothes" style="width:100%;"></span>
        		
				<span style="width:14%; text-align:right;float:left;">Affectations&nbsp;</span>
				<span style="width:84%;float:left;text-align:right;"><input class="bioEdit" type="text" name="attr_affects" style="display:inline-block;width:100%;"></span>
				
        		<span style="width:14%; text-align:right;float:left;">Ethnicity&nbsp;</span>
				<span style="width:35%;float:left;text-align:right;"><input class="bioEdit" type="text" name="attr_ethnic" style="display:inline-block;width:100%;"></span>
        		<span style="width:14%; text-align:right;float:left;">Language&nbsp;</span>
        		<span style="width:35%;float:left;text-align:right;"><input class="bioEdit" type="text" name="attr_lang" style="display:inline-block;width:100%;"></span>
				
				<h5 style="width:100%;float:left;text-align:center;margin:0 0 5px 0;font-size:13px;">Bio &amp; Life events</h5>
				<span style="width:14%;float:left;text-align:right;" style="width:100%;">Family Ranking&nbsp;</span>
				<span style="width:35%;float:left;text-align:right;">
					<select name="attr_family-ranking" style="width:100%;">
							<option value="Corporate Executive">Corporate Executive</option>
							<option value="Corporate Manager">Corporate Manager</option>
							<option value="Corporate Technician">Corporate Technician</option>
							<option value="Nomad Pack">Nomad Pack</option>
							<option value="Pirate Fleet">Pirate Fleet</option>
							<option value="Gang family">Gang family</option>
							<option value="Crime Lord">Crime Lord</option>
							<option value="Combat Zone Poor">Combat Zone Poor</option>
							<option value="Urban homeless">Urban homeless</option>
							<option value="Arcology family">Arcology family</option>
					</select>
				</span> 
				<span style="width:14%;float:left;text-align:right;" style="width:100%;" >Childhood</span>
				<span style="width:35%;float:left;text-align:right;">
					<select name="attr_childhood" style="width:100%;">
						<option value="Spent on the street, with no adult supervision">Spent on the street, with no adult supervision</option>
						<option value="Spent in a safe corporate suburbia">Spent in a safe corporate suburbia</option>
						<option value="In a Nomad Pack moving from town to town">In a Nomad Pack moving from town to town</option>
						<option value="In a decarying, once upscale neighborhood">In a decarying, once upscale neighborhood</option>
						<option value="In a defended corporate zone in the central City">In a defended corporate zone in the central City</option>
						<option value="In the heart of the combat zone">In the heart of the combat zone</option>
						<option value="In a small village or town far from the city">In a small village or town far from the city</option>
						<option value="In a large archology city">In a large archology city</option>
						<option value="In an aquatic pirate pack">In an aquatic pirate pack</option>
						<option value="On a corporate controlled farm or research facility">On a corporate controlled farm or research facility</option>
					</select>
				</span>
				<span style="width:14%;float:left;text-align:right;" style="width:100%;" >Who I value Most</span>
				<span style="width:35%;float:left;text-align:right;">
					<select name="attr_person" style="width:100%;">
						<option value="A parent (or guardian)">A parent or guardian</option>
						<option value="Brother or sister">Brother or sister</option>
						<option value="Lover">Lover</option>
						<option value="Friend">Friend</option>
						<option value="Yourself">Yourself</option>
						<option value="A pet">A pet</option>
						<option value="Teacher or mentor">Teacher or mentor</option>
						<option value="Public figure">Public figure</option>
						<option value="A personal hero">A personal hero</option>
						<option value="No one">No one</option>
					</select>
				</span>
				<span style="width:14%;float:left;text-align:right;" style="width:100%;" >What I Value Most</span>
				<span style="width:35%;float:left;text-align:right;">
					<select name="attr_most-value" style="width:100%;">
						<option value="Money">Money</option>
						<option value="Honor">Honor</option>
						<option value="Your word">Your word</option>
						<option value="Honesty">Honesty</option>
						<option value="Knowledge">Knowledge</option>
						<option value="Vengeance">Vengeance</option>
						<option value="Love">Love</option>
						<option value="Power">Power</option>
						<option value="Having a good time">Having a good time</option>
						<option value="Friendship">Friendship</option>
					</select>
				</span>
				<span style="width:14%;float:left;text-align:right;" style="width:100%;" >How I Feel About Most People</span>
				<span style="width:35%;float:left;text-align:right;">
					<select name="attr_feel-people" style="width:100%;">
						<option value="Neutral">Neutral</option>
						<option value="I like almost everyone">I like almost everyone</option>
						<option value="I hate almost everyone">I hate almost everyone</option>
						<option value="People are tools. Use them for your own goals and discard them">People are tools. Use them for your own goals and discard them</option>
						<option value="Every person is a valuable individual">Every person is a valuable individual</option>
						<option value="People are obstacles to be destroyed if they cross me">People are obstacles to be destroyed if they cross me</option>
						<option value="People are untrustworthy. Don't depend on anyone">People are untrustworthy. Don't depend on anyone</option>
						<option value="Wipe 'em all out and give the place to the cockroaches">Wipe 'em all out and give the place to the cockroaches</option>
						<option value="People are wonderful">People are wonderful</option>
					</select>
				</span>
				<span style="width:14%;float:left;text-align:right;" style="width:100%;" >Most Valued Possession</span>
				<span style="width:35%;float:left;text-align:right;">
					<select name="attr_value-possession" style="width:100%;">
						<option value="A weapon">A weapon</option>
						<option value="A tool">A tool</option>
						<option value="A piece of clothing">A piece of clothing</option>
						<option value="A photograph">A photograph</option>
						<option value="A book or diary">A book or diary</option>
						<option value="A recording">A recording</option>
						<option value="A musical instrument">A musical instrument</option>
						<option value="A piece of jewelry">A piece of jewelry</option>
						<option value="A toy">A toy</option>
						<option value="A letter">A letter</option>
					</select>
				</span>

				<h5 style="width:100%;float:left;text-align:center;margin:0 0 5px 0;font-size:13px;">Family</h5>
				<fieldset class="repeating_family">
					<input type="text" style="width:20%;" name="attr_familyname" placeholder="Name">
					<input type="text" style="width:75%;" name="attr_familydetil" placeholder="Description">
				</fieldset>

				<h5 style="width:100%;float:left;text-align:center;margin:0 0 5px 0;font-size:13px;">Events</h5>
				<fieldset class"repeating_lifeevents">
					<input type="text" style="width:20%;" name="attr_eventage" placeholder="Age">
					<input type="text" style="width:75%;" name="attr_familydetil" placeholder="Event">
				</fieldset>
			</div>
		</span>
	</div>
</div>  <!-- BODY -->

<rolltemplate class="sheet-rolltemplate-skill">
    <table style="width:95%;margin:0 auto 0 auto;border:1px solid #000033;">
        <tr>
            <th colspan="2" style="background-color:#000066;color:white;text-align:center;">{{name}}</th>
        </tr>
        <tr>
            <td colspan="2" style="text-align:center;" >{{skillname}}</td>
        </tr>
        <tr>
            <td><strong>Modifier:</strong></td>
            <td>{{mod}}</td>
        </tr>
        <tr>
            <td><strong>Result: </strong></td>
            <td>{{result}}
                {{#rollWasFumble() result}}
                {{#^rollTotal() fumble 1}}
                <strong style="color:red">Fumble</strong>
                {{/^rollTotal() fumble 1}}
                {{/rollWasFumble() result}}
            </td>
        </tr>
    </table>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-attack">
    <table style="width:95%;margin:0 auto 0 auto;border:1px solid #000033;">
        <tr>
            <th colspan="2" style="background-color:#000066;color:white;text-align:center;">{{name}}</th>
        </tr>
        <tr>
            <td colspan="2" style="text-align:center;" >{{weapon}}</td>
        </tr>
        <tr>
            <td><strong>Modifier:</strong></td>
            <td>{{mod}}</td>
        </tr>
        <tr>
            <td><strong>Result: </strong></td>
            <td>{{result}}
                {{#rollWasFumble() result}}
                {{#^rollTotal() fumble 1}}
                <strong style="color:red">Fumble</strong>
                {{/^rollTotal() fumble 1}}
                {{/rollWasFumble() result}}
            </td>
        </tr>
        <tr>
            {{#dmg}}
            <td><strong>Damage: </strong></td>
            <td>{{dmg}}</td>
            {{/dmg}}
		</tr>
		<tr>
			<td><strong>Location</strong></td>
            {{#loc}}
            <td>
                {{#rollTotal() loc 1 }}
                <strong style="color:red">
                    {{#rollBetween() dmgCrt 5 10 }}Head{{/rollBetween() dmgCrt 5 10 }}
                    {{#rollBetween() dmgCrt 1 4 }}Face{{/rollBetween() dmgCrt 1 4 }}
                </strong>
                {{/rollTotal() loc 1 }}
                {{#rollBetween() loc 2 4 }}Chest{{/rollBetween() loc 2 4 }}
                {{#rollTotal() loc 5 }}Right Arm{{/rollTotal() loc 5 }}
                {{#rollTotal() loc 6 }}Left Arm{{/rollTotal() loc 6 }}
                {{#rollBetween() loc 7 8 }}Right Leg{{/rollBetween() loc 7 8 }}
                {{#rollBetween() loc 9 10 }}Left Leg{{/rollBetween() loc 9 10 }}
            </td>
            {{/loc}}
        </tr>
    </table>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-save">
    <table style="width:95%;margin:0 auto 0 auto;border:1px solid #000033;">
        <tr>
            <th colspan="3" style="background-color:#000066;color:white;text-align:center;">{{name}}:SAVE</th>
        </tr>
        <tr>
            <td><strong>Modifier: </strong></td>
            <td colspan="2">{{mod}}</td>
        </tr>
        <tr>
            <td><strong>Stun&nbsp;:&nbsp;</strong></td>
            <td>{{saveStunRoll}}</td>
            <td>
                {{#rollGreater() saveStunRoll rangeStun }}
                <strong style="color:red">Failure</strong>
                {{/rollGreater() saveStunRoll rangeStun }}
                {{#^rollGreater() saveStunRoll rangeStun }}
                <strong style="color:green">Success</strong>
                {{/^rollGreater() saveStunRoll rangeStun }}
            </td>
        </tr>
        <tr>
            <td><strong>Death&nbsp;:&nbsp;</strong></td>
            <td>{{saveDeathRoll}}</td>
            <td>
                {{#rollGreater() saveDeathRoll rangeDeath }}
                <strong style="color:red">Failure</strong>
                {{/rollGreater() saveDeathRoll rangeDeath }}
                {{#^rollGreater() saveDeathRoll rangeDeath }}
                <strong style="color:green">Success</strong>
                {{/^rollGreater() saveDeathRoll rangeDeath }}
            </td>
        </tr>
    </table>
</rolltemplate>


<rolltemplate class="sheet-rolltemplate-prog">
    <table>
        <tr>
            <th colspan="2">{{name}}</th>
        </tr>
        <tr>
            <td colspan="2"><strong>{{progname}} ({{progtype}})</strong></td>
        </tr>
        <tr>
            <td colspan="2">
                {{effect}}
            </td>
        </tr>
        {{#rollGreater() roll 0 }}
        <tr>
            <td><strong>Result: </strong></td>
            <td>{{roll}}</td>
        </tr>
        {{/rollGreater() roll 0 }}
        {{#rollGreater() dmg 0 }}
        <tr>
            <td><strong>Damage: </strong></td>
            <td>{{dmg}}</td>
        </tr>
        {{/rollGreater() dmg 0 }}
    </table>
</rolltemplate>

<script type="text/worker">

const repeatingSum = (destinations, section, fields) => {
    if (!Array.isArray(destinations)) destinations = [destinations.replace(/\s/g, '').split(',')];
    if (!Array.isArray(fields)) fields = [fields.replace(/\s/g, '').split(',')];
    getSectionIDs(`repeating_${section}`, idArray => {
        const attrArray = idArray.reduce((m, id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))], []);
        getAttrs([...attrArray], v => {
            const getValue = (section, id, field) => v[`repeating_${section}_${id}_${field}`] === 'on' ? 1 : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
            const commonMultipliers = (fields.length <= destinations.length) ? [] : fields.splice(destinations.length, fields.length - destinations.length);
            const output = {};
            destinations.forEach((destination, index) => {
                output[destination] = idArray.reduce((total, id) => total + getValue(section, id, fields[index]) * commonMultipliers.reduce((subtotal, mult) => subtotal * getValue(section, id, mult), 1), 0);
            });
            setAttrs(output);
        }); 
    }); 
};


/* HEALTH */
on("sheet:opened change:wounds change:body change:body_mod change:ma change:ma_mod change:int change:cool change:ref change:int_mod change:cool_mod change:ref_mod", function() {
    getAttrs([ "wounds", "body","ref","ma","int","cool","body_mod","ref_mod","ma_mod","int_mod","cool_mod" ], function(values){
        let totalWounds = parseInt(values.wounds);
		let refBase = (parseInt(values.ref)+parseInt(values.ref_mod));
		let maBase = (parseInt(values.ma)+parseInt(values.ma_mod));
		let intBase = (parseInt(values.int)+parseInt(values.int_mod));
		let coolBase = (parseInt(values.cool)+parseInt(values.cool_mod));
		let bodyBase = (parseInt(values.body)+parseInt(values.body_mod));

		let refPenalty = 0;
		let maPenalty= 0;
		let intPenalty = 0;
		let coolPenalty = 0;
		let stunSaveMod = 0;
		let deathSaveMod = 0;
		
		let stun=0;
		let mortal=0;
        var statusMessage = "Arrgh";
		var penaltyMessage = "No message";
		
		if (0==totalWounds) {
			statusMessage = "Healthy";
			penaltyMessage = "No penalties";
		} else if (5 > totalWounds ) {
			statusMessage = "Light";
			penaltyMessage = "No Penalty";				
		} else if ( 9 > totalWounds ) {
            statusMessage = "Serious";
            penaltyMessage = "Ref -2. Movement -2";
			stun=1;
			refPenalty = 2;
			maPenalty = 2;
        } else if ( 13 > totalWounds ) {
            statusMessage = "Critical";
            penaltyMessage = "Ref, Int, Cool at Half. Movement at half rate.";
			stun=2;
			refPenalty = Math.floor(refBase/2);
			maPenalty = Math.floor(maBase/2);
			intPenalty = Math.floor(intBase/2);
			coolPenalty = Math.floor(coolBase/2);
        } else if ( 17 > totalWounds ) {
            statusMessage = "Mortal 0";
			penaltyMessage = "Ref, Int, Cool at one third. Cannot move.";
			stun=2;
			mortal = 0;
			refPenalty = Math.floor((refBase * 2)/3);
			maPenalty = maBase;
			intPenalty = Math.floor((intBase * 2)/3);
			coolPenalty = Math.floor((coolBase * 2)/3);
        } else if ( 21 > totalWounds ) {
            statusMessage = "Mortal 1";
			penaltyMessage = "Ref, Int, Cool at one third. Cannot move.";
			stun=3;
			mortal = 1;
			refPenalty = Math.floor((refBase * 2)/3);
			maPenalty = maBase;
			intPenalty = Math.floor((intBase * 2)/3);
			coolPenalty = Math.floor((coolBase * 2)/3);
        } else if ( 25 > totalWounds ) {
            statusMessage = "Mortal 2";
			penaltyMessage = "Ref, Int, Cool at one third. Cannot move.";
			stun=4;
			mortal = 2;
			refPenalty = Math.floor((refBase * 2)/3);
			maPenalty = maBase;
			intPenalty = Math.floor((intBase * 2)/3);
			coolPenalty = Math.floor((coolBase * 2)/3);
        } else if ( 29 > totalWounds ) {
            statusMessage = "Mortal 3";
			penaltyMessage = "Ref, Int, Cool at one third. Cannot move.";
			stun=5;
			mortal = 3;
			refPenalty = Math.floor((refBase * 2)/3);
			maPenalty = maBase;
			intPenalty = Math.floor((intBase * 2)/3);
			coolPenalty = Math.floor((coolBase * 2)/3);
        } else if ( 33 > totalWounds ) {
            statusMessage = "Mortal 4";
			penaltyMessage = "Ref, Int, Cool at one third. Cannot move.";
			stun=6;
			mortal = 4;
			refPenalty = Math.floor((refBase * 2)/3);
			maPenalty = maBase;
			intPenalty = Math.floor((intBase * 2)/3);
			coolPenalty = Math.floor((coolBase * 2)/3);
        } else if ( 37 > totalWounds ) {
            statusMessage = "Mortal 5";
			penaltyMessage = "Ref, Int, Cool at one third. Cannot move.";
			stun=7;
			mortal = 5;
			refPenalty = Math.floor((refBase * 2)/3);
			maPenalty = maBase;
			intPenalty = Math.floor((intBase * 2)/3);
			coolPenalty = Math.floor((coolBase * 2)/3);
        } else if ( 41 > totalWounds ) {
            statusMessage = "Mortal 6";
			penaltyMessage = "Ref, Int, Cool at one third. Cannot move.";	
			stun=8;
			mortal = 6;
			refPenalty = Math.floor((refBase * 2)/3);
			maPenalty = maBase;
			intPenalty = Math.floor((intBase * 2)/3);
			coolPenalty = Math.floor((coolBase * 2)/3);
        } else if ( 45 > totalWounds ) {
            statusMessage = "Mortal 7";
			penaltyMessage = "Ref, Int, Cool cannot be used. Cannot move.";	
			stun=9;
			mortal = 7;
			refPenalty = refBase;
			maPenalty = maBase;
			intPenalty = intBase;
			coolPenalty = coolBase;
        } else if ( 49 > totalWounds ) {
            statusMessage = "Mortal 8";
			penaltyMessage = "Ref, Int, Cool cannot be used. Cannot move.";	
			stun=10;
			mortal = 8;
			refPenalty = refBase;
			maPenalty = mabase;
			intPenalty = intBase;
			coolPenalty = coolBase;
        } else if ( 53 > totalWounds ) {
            statusMessage = "Mortal 9";
			penaltyMessage = "Ref, Int, Cool cannot be used. Cannot move.";	
			stun=11;
			mortal = 9;
			refPenalty = refBase;
			maPenalty = maBase;
			intPenalty = intBase;
			coolPenalty = coolBase;
        } else if ( 57 > totalWounds ) {
            statusMessage = "Mortal 10";
			penaltyMessage = "You're probably dead.";	
			stun=12;
			mortal = 10;
			refPenalty = refBase;
			maPenalty = maBase;
			intPenalty = intBase;
			coolPenalty = coolBase;
        } else {
            statusMessage = "Mortal 10";
			penaltyMessage = "Quick - call Trauma Team Now!";	
			stun=12;
			mortal = 10;
			refPenalty = refBase;
			maPenalty = maBase;
			intPenalty = intBase;
			coolPenalty = coolBase;		
		}
		
		stunSaveMod = bodyBase - stun;
		if (0 > stunSaveMod) { stunSaveMod = 0;}
		
		deathSaveMod = bodyBase - mortal;
		if (0 > deathSaveMod) { deathSaveMod = 0;}
	
		setAttrs({
            woundstate : statusMessage,
			penaltytext : penaltyMessage,
			stunSave : stunSaveMod,
			deathSave : deathSaveMod,
			int_penalty : intPenalty,
			ref_penalty : refPenalty,
			cool_penalty : coolPenalty,
			ma_penalty : maPenalty
        });
    });
});

/* INITIATIVE ROLL */
on("sheet:opened change:character_role", function() {
    getAttrs([ "character_role" ], function(values){
		let initScript = "";
		let classBase = values.character_role;

		if ( classBase == "solo" ) {
			initScript = "&{template:skill}{{name=@{character_name}}}{{skillname=Initiative}} {{result=[[1d10!cf<1 +@{special_ability_value} + @{ref} + @{ref_mod} - @{ref_penalty} + @{initiativebonuses} &{tracker} ]] }}";
		} else {
			initScript = "&{template:skill}{{name=@{character_name}}}{{skillname=Initiative}} {{result=[[1d10!cf<1 + @{ref} + @{ref_mod} - @{ref_penalty} + @{initiativebonuses} &{tracker}]] }}";
		}
		
		setAttrs ({
			initiativescript : initScript
		});
    });
});

/* MOVEMENT SECONDARIES */
on("sheet:opened change:ma change:ma_mod", function() {
    getAttrs([ "ma","ma_mod" ], function(values){
		let basema = (parseInt(values.ma) + parseInt(values.ma_mod));
		let valrun=basema*3;
		let valleap=Math.floor(valrun/4);
		
		setAttrs ({
			run : valrun,
			leap : valleap
		});
    });
});


/* BTM MODIFIER */
on("sheet:opened change:body change:body_mod", function() {
    getAttrs([ "body","body_mod" ], function(values){
		let baseBody = (parseInt(values.body) + parseInt(values.body_mod));
		let valbtm=0;
		let vallift=baseBody*40;
		
		if (2 == baseBody) {
			valbtm = 0;
		} else if (5 > baseBody) {
			valbtm = -1;
		} else if (8 > baseBody) {
			valbtm = -2;
		} else if (10 > baseBody) {
			valbtm = -3
		} else if (10 == baseBody) {
			valbtm = -4;
		} else {
			valbtm = -5;
		}
		
		setAttrs ({
			btm : valbtm,
			lift : vallift
		});
    });
});


/* CYBERWARE & HUMANITY */
on("sheet:opened change:total_cyb", function() {
    getAttrs([ "total_cyb","emp","emp_mod" ], function(v){
        let penalties = Math.floor(parseInt(v.total_cyb) / 10);
        let humanity = (parseInt(v.emp) + parseInt(v.emp_mod)) * 10 - parseInt(v.total_cyb);
        setAttrs({
            emp_penality : penalties,
            hum : humanity
        });
    });
});

on("sheet:opened change:repeating_cyberware:cyberhumanitycost", (event) => {
    repeatingSum("total_cyb","cyberware","cyberhumanitycost");
})

/* ARMOUR */
on("sheet:opened change:armor_macro change:armor_auto_enc change:skinweaveLegs change:skinweave change:layer_1 change:head_1 change:face_1 change:torso_1 change:rArm_1 change:lArm_1 change:rLeg_1 change:lLeg_1 change:enc_1 change:layer_2 change:head_2 change:face_2 change:torso_2 change:rArm_2 change:lArm_2 change:rLeg_2 change:lLeg_2 change:enc_2 change:layer_3 change:head_3 change:face_3 change:torso_3 change:rArm_3 change:lArm_3 change:rLeg_3 change:lLeg_3 change:enc_3", function(){
    getAttrs([
        "layer_1",
        "head_1",
        "face_1",
        "torso_1",
        "rArm_1",
        "lArm_1",
        "rLeg_1",
        "lLeg_1",
        "enc_1",
        "skinweave",
        "skinweaveLegs",
        "layer_2",
        "head_2",
        "face_2",
        "torso_2",
        "rArm_2",
        "lArm_2",
        "rLeg_2",
        "lLeg_2",
        "enc_2",
        "layer_3",
        "head_3",
        "face_3",
        "torso_3",
        "rArm_3",
        "lArm_3",
        "rLeg_3",
        "lLeg_3",
        "enc_3",
        "armor_auto_enc",
    ], function(v){
        var faces = 0;
        var heads = 0;
        var torsos = 0;
        var rArms = 0;
        var lArms = 0;
        var rLegs = 0;
        var lLegs = 0;
        var encs = 0;

		for (var i=1;i<4;i++){
			if (1 == eval('v.layer_'+i)){
				faces += parseInt(eval('v.face_'+i));
				heads += parseInt(eval('v.head_'+i));
				torsos += parseInt(eval('v.torso_'+i));
				rArms += parseInt(eval('v.rArm_'+i));
				lArms += parseInt(eval('v.lArm_'+i));
				rLegs += parseInt(eval('v.rLeg_'+i));
				lLegs += parseInt(eval('v.lLeg_'+i));
				encs += parseInt(eval('v.enc_'+i));
			}
		}
        setAttrs({
			face_sp : faces,
			head_sp : heads,
			torso_sp : torsos,
			rarm_sp : rArms,
			larm_sp : lArms,
			rleg_sp : rLegs,
			lleg_sp : lLegs
		});
    });
});

/* REPUTATION */
on("sheet:opened change:rep", function(){
    getAttrs([ "rep" ], function(v){
        var rep = parseInt(v.rep);
        var status = "unknown";
        switch (rep){
            case 1:
                status = "Anyone who was there at the time knows";
                break;
            case 2:
                status = "Stories have gotten around to immediate friends";
                break;
            case 3:
                status = "All co-workers and casual acquaintances know";
                break;
            case 4:
                status = "Stories are all over the local area";
                break;
            case 5:
                status = "Your name is recognized by others beyond your local area";
                break;
            case 6:
                status = "You are known on sight by others beyond your local area";
                break;
            case 7:
                status = "A news story or two has been written about your exploits";
                break;
            case 8:
                status = "Your exploits regulary make the headlines and screamsheets";
                break;
            case 9:
                status = "Your exploits always make the screamsheets and net news";
                break;
            case 10:
                status = "You're known worldwide";
                break;
            }
            setAttrs({ repStatus : status });
        });
    });

/* ---- BEGIN: TheAaronSheet.js ---- */
// Github:   https://github.com/shdwjk/TheAaronSheet/blob/master/TheAaronSheet.js
// By:       The Aaron, Arcane Scriptomancer
// Contact:  https://app.roll20.net/users/104025/the-aaron

var TAS = TAS || (function(){
    'use strict';
 
    var version = '0.2.5',
        lastUpdate = 1504710542,
 
        loggingSettings = {
            debug: {
                key:     'debug',
                title:   'DEBUG',
                color: {
                    bgLabel: '#7732A2',
                    label:   '#F2EF40',
                    bgText:  '#FFFEB7',
                    text:    '#7732A2'
                }
            },
            error: {
                key:     'error',
                title:   'Error',
                color: {
                    bgLabel: '#C11713',
                    label:   'white',
                    bgText:  '#C11713',
                    text:    'white'
                }
            },
            warn: {
                key:     'warn',
                title:   'Warning',
                color: {
                    bgLabel: '#F29140',
                    label:   'white',
                    bgText:  '#FFD8B7',
                    text:    'black'
                }
            },
            info: {
                key:     'info',
                title:   'Info',
                color: {
                    bgLabel: '#413FA9',
                    label:   'white',
                    bgText:  '#B3B2EB',
                    text:    'black'
                }
            },
            notice: {
                key:     'notice',
                title:   'Notice',
                color: {
                    bgLabel: '#33C133',
                    label:   'white',
                    bgText:  '#ADF1AD',
                    text:    'black'
                }
            },
            log: {
                key:     'log',
                title:   'Log',
                color: {
                    bgLabel: '#f2f240',
                    label:   'black',
                    bgText:  '#ffff90',
                    text:    'black'
                }
            },
            callstack: {
                key:     'TAS',
                title:   'function',
                color: {
                    bgLabel: '#413FA9',
                    label:   'white',
                    bgText:  '#B3B2EB',
                    text:    'black'
                }
            },
            callstack_async: {
                key:     'TAS',
                title:   'ASYNC CALL',
                color: {
                    bgLabel: '#413FA9',
                    label:   'white',
                    bgText:  '#413FA9',
                    text:    'white'
                }
            },
            TAS: {
                key:     'TAS',
                title:   'TAS',
                color: {
                    bgLabel: 'grey',
                    label:   'black;background:linear-gradient(#304352,#d7d2cc,#d7d2cc,#d7d2cc,#304352)',
                    bgText:  'grey',
                    text:    'black;background:linear-gradient(#304352,#d7d2cc,#d7d2cc,#d7d2cc,#304352)'
                }
            }
        },
 
 
        config = {
            debugMode: false,
            logging: {
                log: true,
                notice: true,
                info: true,
                warn: true,
                error: true,
                debug: false
            }
        },
 
        callstackRegistry = [],
        queuedUpdates = {}, //< Used for delaying saves till the last moment.
 
    complexType = function(o){
        switch(typeof o){
            case 'string':
                return 'string';
            case 'boolean':
                return 'boolean';
            case 'number':
                return (_.isNaN(o) ? 'NaN' : (o.toString().match(/\./) ? 'decimal' : 'integer'));
            case 'function':
                return 'function: '+(o.name ? o.name+'()' : '(anonymous)');
            case 'object':
                return (_.isArray(o) ? 'array' : (_.isArguments(o) ? 'arguments' : ( _.isNull(o) ? 'null' : 'object')));
            default:
                return typeof o;
        }
    },
 
    dataLogger = function(primaryLogger,secondaryLogger,data){
        _.each(data,function(m){
            var type = complexType(m);
            switch(type){
                case 'string':
                    primaryLogger(m);
                    break;
                case 'undefined':
                case 'null':
                case 'NaN':
                    primaryLogger('['+type+']');
                    break;
                case 'number':
                case 'not a number':
                case 'integer':
                case 'decimal':
                case 'boolean':
                    primaryLogger('['+type+']: '+m);
                    break;
                default:
                    primaryLogger('['+type+']:=========================================');
                    secondaryLogger(m);
                    primaryLogger('=========================================================');
                    break;
            }
        });
    },
 
 
    colorLog = function(options){
        var coloredLoggerFunction,
            key = options.key,
            label = options.title || 'TAS',
            lBGColor = (options.color && options.color.bgLabel) || 'blue',
            lTxtColor = (options.color && options.color.label) || 'white',
            mBGColor = (options.color && options.color.bgText) || 'blue',
            mTxtColor = (options.color && options.color.text) || 'white';
 
        coloredLoggerFunction = function(message){
            /* eslint-disable no-console */
            console.log(
                '%c '+label+': %c '+message + ' ',
                'background-color: '+lBGColor+';color: '+lTxtColor+'; font-weight:bold;',
                'background-color: '+mBGColor+';color: '+mTxtColor+';'
            );
            /* eslint-enable no-console */
        };
        return function(){
            if('TAS'===key || config.logging[key]){
                /* eslint-disable no-console */
               dataLogger(coloredLoggerFunction,function(m){console.log(m);},_.toArray(arguments));
                /* eslint-enable no-console */
            }
        };
    },
 
    logDebug  = colorLog(loggingSettings.debug),
    logError  = colorLog(loggingSettings.error),
    logWarn   = colorLog(loggingSettings.warn),
    logInfo   = colorLog(loggingSettings.info),
    logNotice = colorLog(loggingSettings.notice),
    logLog    = colorLog(loggingSettings.log),
    log       = colorLog(loggingSettings.TAS),
    logCS     = colorLog(loggingSettings.callstack),
    logCSA    = colorLog(loggingSettings.callstack_async),
 
    registerCallstack = function(callstack,label){
        var idx=_.findIndex(callstackRegistry,function(o){
            return (_.difference(o.stack,callstack).length === _.difference(callstack,o.stack).length) &&
                _.difference(o.stack,callstack).length === 0 &&
                o.label === label;
        });
        if(-1 === idx){
            idx=callstackRegistry.length;
            callstackRegistry.push({
                stack: callstack,
                label: label
            });
        }
        return idx;
    },
 
    setConfigOption = function(options){
        var newconf =_.defaults(options,config);
        newconf.logging=_.defaults(
            (options && options.logging)||{},
            config.logging
        );
        config=newconf;
    },
   
    isDebugMode = function(){
        return config.debugMode;
    },
 
    debugMode = function(){
        config.logging.debug=true;
        config.debugMode = true;
    },
 
    getCallstack = function(){
        var e = new Error('dummy'),
            stack = _.map(_.rest(e.stack.replace(/^[^(]+?[\n$]/gm, '')
            .replace(/^\s+at\s+/gm, '')
            .replace(/^Object.<anonymous>\s*\(/gm, '{anonymous}()@')
            .split('\n')),function(l){
                return l.replace(/\s+.*$/,'');
            });
        return stack;
    },
    logCallstackSub = function(cs){
        var matches, csa;
        _.find(cs,function(line){
            matches = line.match(/TAS_CALLSTACK_(\d+)/);
            if(matches){
               csa=callstackRegistry[matches[1]];
               logCSA( '===================='+(csa.label ? '> '+csa.label+' <' : '')+'====================');
               logCallstackSub(csa.stack);
               return true;
            }
            logCS(line);
            return false;
        });
    },
    logCallstack = function(){
        var cs;
        if(config.debugMode){
            cs = getCallstack();
            cs.shift();
            log('==============================> CALLSTACK <==============================');
            logCallstackSub(cs);
            log('=========================================================================');
        }
    },
 
 
    wrapCallback = function (label, callback, context){
        var callstack;
        if('function' === typeof label){
            context=callback;
            callback=label;
            label=undefined;
        }
        if(!config.debugMode){
            return (function(cb,ctx){
                return function(){
                    cb.apply(ctx||{},arguments);
                };
            }(callback,context));
        }
       
        callstack = getCallstack();
        callstack.shift();
       
        return (function(cb,ctx,cs,lbl){
            var ctxref=registerCallstack(cs,lbl);
 
            /*jshint -W054 */
            return new Function('cb','ctx','TASlog',
                "return function TAS_CALLSTACK_"+ctxref+"(){"+
                    "var start,end;"+
                    "TASlog('Entering: '+(cb.name||'(anonymous function)'));"+
                    "start=_.now();"+
                    "cb.apply(ctx||{},arguments);"+
                    "end=_.now();"+
                    "TASlog('Exiting: '+(cb.name||'(anonymous function)')+' :: '+(end-start)+'ms elapsed');"+
                "};")(cb,ctx,log);
            /*jshint +W054 */
        }(callback,context,callstack,label));
    },
 
 
    prepareUpdate = function( attribute, value ){
        queuedUpdates[attribute]=value;
    },
 
    applyQueuedUpdates = function() {
      setAttrs(queuedUpdates);
      queuedUpdates = {};
    },
 
    namesFromArgs = function(args,base){
        return _.chain(args)
            .reduce(function(memo,attr){
                if('string' === typeof attr) {
                    memo.push(attr);
                } else if(_.isArray(args) || _.isArguments(args)){
                    memo = namesFromArgs(attr,memo);
                }
                return memo;
            },(_.isArray(base) && base) || [])
            .uniq()
            .value();
    },
 
    addId = function(obj,value){
        Object.defineProperty(obj,'id',{
            value: value,
            writable: false,
            enumerable: false
        });
    },
 
    addProp = function(obj,prop,value,fullname){
        (function(){
            var pname=(_.contains(['S','F','I','D'],prop) ? '_'+prop : prop),
                full_pname = fullname || prop,
                pvalue=value;
 
            _.each(['S','I','F'],function(p){
                if( !_.has(obj,p)){
                    Object.defineProperty(obj, p, {
                        value: {},
                        enumerable: false,
                        readonly: true
                    });
                }
            });
            if( !_.has(obj,'D')){
                Object.defineProperty(obj, 'D', {
                    value: _.reduce(_.range(10),function(m,d){
                            Object.defineProperty(m, d, {
                                value: {},
                                enumerable: true,
                                readonly: true
                            });
                            return m;
                        },{}),
                    enumerable: false,
                    readonly: true
                });
            }
 
 
            // Raw value
            Object.defineProperty(obj, pname, {
                enumerable: true,
                set: function(v){
                    if(v!==pvalue) {
                        pvalue=v;
                        prepareUpdate(full_pname,v);
                    }
                },
                get: function(){
                    return pvalue;
                }
            });
           
            // string value
            Object.defineProperty(obj.S, pname, {
                enumerable: true,
                set: function(v){
                    var val=v.toString();
                    if(val !== pvalue) {
                        pvalue=val;
                        prepareUpdate(full_pname,val);
                    }
                },
                get: function(){
                    return pvalue.toString();
                }
            });
 
            // int value
            Object.defineProperty(obj.I, pname, {
                enumerable: true,
                set: function(v){
                    var val=parseInt(v,10) || 0;
                    if(val !== pvalue){
                        pvalue=val;
                        prepareUpdate(full_pname,val);
                    }
                },
                get: function(){
                    return parseInt(pvalue,10) || 0;
                }
            });
 
            // float value
            Object.defineProperty(obj.F, pname, {
                enumerable: true,
                set: function(v){
                    var val=parseFloat(v) || 0;
                    if(val !== pvalue) {
                        pvalue=val;
                        prepareUpdate(full_pname,val);
                    }
                },
                get: function(){
                    return parseFloat(pvalue) || 0;
                }
            });
            _.each(_.range(10),function(d){
                Object.defineProperty(obj.D[d], pname, {
                    enumerable: true,
                    set: function(v){
                        var val=(parseFloat(v) || 0).toFixed(d);
                        if(val !== pvalue){
                            pvalue=val;
                            prepareUpdate(full_pname,val);
                        }
                    },
                    get: function(){
                        return (parseFloat(pvalue) || 0).toFixed(d);
                    }
                });
            });
 
        }());
    },
   
    repeating = function( section ) {
        return (function(s){
            var sectionName = s,
                attrNames = [],
                fieldNames = [],
                operations = [],
                after = [],
           
            repAttrs = function TAS_Repeating_Attrs(){
                attrNames = namesFromArgs(arguments,attrNames);
                return this;
            },
            repFields = function TAS_Repeating_Fields(){
                fieldNames = namesFromArgs(arguments,fieldNames);
                return this;
            },
            repReduce = function TAS_Repeating_Reduce(func, initial, final, context) {
                operations.push({
                    type: 'reduce',
                    func: (func && _.isFunction(func) && func) || _.noop,
                    memo: (_.isUndefined(initial) && 0) || initial,
                    final: (final && _.isFunction(final) && final) || _.noop,
                    context: context || {}
                });
                return this;
            },
            repMap = function TAS_Repeating_Map(func, final, context) {
                operations.push({
                    type: 'map',
                    func: (func && _.isFunction(func) && func) || _.noop,
                    final: (final && _.isFunction(final) && final) || _.noop,
                    context: context || {}
                });
                return this;
            },
            repEach = function TAS_Repeating_Each(func, final, context) {
                operations.push({
                    type: 'each',
                    func: (func && _.isFunction(func) && func) || _.noop,
                    final: (final && _.isFunction(final) && final) || _.noop,
                    context: context || {}
                });
                return this;
            },
            repTap = function TAS_Repeating_Tap(final, context) {
                operations.push({
                    type: 'tap',
                    final: (final && _.isFunction(final) && final) || _.noop,
                    context: context || {}
                });
                return this;
            },
            repAfter = function TAS_Repeating_After(callback,context) {
                after.push({
                    callback: (callback && _.isFunction(callback) && callback) || _.noop,
                    context: context || {}
                });
                return this;
            },
            repExecute = function TAS_Repeating_Execute(callback,context){
                var rowSet = {},
                    attrSet = {},
                    fieldIds = [],
                    fullFieldNames = [];
 
                repAfter(callback,context);
 
                // call each operation per row.
                // call each operation's final
                getSectionIDs("repeating_"+sectionName,function(ids){
                    fieldIds = ids;
                    fullFieldNames = _.reduce(fieldIds,function(memo,id){
                        return memo.concat(_.map(fieldNames,function(name){
                            return 'repeating_'+sectionName+'_'+id+'_'+name;  
                        }));
                    },[]);
                    getAttrs( _.uniq(attrNames.concat(fullFieldNames)), function(values){
                        _.each(attrNames,function(aname){
                            if(values.hasOwnProperty(aname)){
                                addProp(attrSet,aname,values[aname]);
                            }
                        });
 
                        rowSet = _.reduce(fieldIds,function(memo,id){
                            var r={};
                            addId(r,id);
                            _.each(fieldNames,function(name){
                                var fn = 'repeating_'+sectionName+'_'+id+'_'+name;  
                                addProp(r,name,values[fn],fn);
                            });
 
                            memo[id]=r;
 
                            return memo;
                        },{});
 
                        _.each(operations,function(op){
                            var res;
                            switch(op.type){
                                case 'tap':
                                    _.bind(op.final,op.context,rowSet,attrSet)();
                                    break;
 
                                case 'each':
                                    _.each(rowSet,function(r){
                                        _.bind(op.func,op.context,r,attrSet,r.id,rowSet)();
                                    });
                                    _.bind(op.final,op.context,rowSet,attrSet)();
                                    break;
 
                                case 'map':
                                    res = _.map(rowSet,function(r){
                                        return _.bind(op.func,op.context,r,attrSet,r.id,rowSet)();
                                    });
                                    _.bind(op.final,op.context,res,rowSet,attrSet)();
                                    break;
 
                                case 'reduce':
                                    res = op.memo;
                                    _.each(rowSet,function(r){
                                        res = _.bind(op.func,op.context,res,r,attrSet,r.id,rowSet)();
                                    });
                                    _.bind(op.final,op.context,res,rowSet,attrSet)();
                                    break;
                            }
                        });
 
                        // finalize attrs
                        applyQueuedUpdates();
                        _.each(after,function(op){
                            _.bind(op.callback,op.context)();
                        });
                    });
                });
            };
               
            return {
                attrs: repAttrs,
                attr: repAttrs,
 
                column: repFields,
                columns: repFields,
                field: repFields,
                fields: repFields,
 
                reduce: repReduce,
                inject: repReduce,
                foldl: repReduce,
 
                map: repMap,
                collect: repMap,
 
                each: repEach,
                forEach: repEach,
 
                tap: repTap,
                'do': repTap,
 
                after: repAfter,
                last: repAfter,
                done: repAfter,
 
                execute: repExecute,
                go: repExecute,
                run: repExecute
            };
        }(section));
    },
 
 
    repeatingSimpleSum = function(section, field, destination){
        repeating(section)
            .attr(destination)
            .field(field)
            .reduce(function(m,r){
                return m + (r.F[field]);
            },0,function(t,r,a){
                a.S[destination]=t;
            })
            .execute();
    };
 
    /* eslint-disable no-console */
    console.log('%câ€¢.Â¸Â¸.â€¢*Â´Â¨`*â€¢.Â¸Â¸.â€¢*Â´Â¨`*â€¢.Â¸  The Aaron Sheet  v'+version+'  Â¸.â€¢*Â´Â¨`*â€¢.Â¸Â¸.â€¢*Â´Â¨`*â€¢.Â¸Â¸.â€¢','background: linear-gradient(to right,green,white,white,green); color:black;text-shadow: 0 0 8px white;');
    console.log('%câ€¢.Â¸Â¸.â€¢*Â´Â¨`*â€¢.Â¸Â¸.â€¢*Â´Â¨`*â€¢.Â¸  Last update: '+(new Date(lastUpdate*1000))+'  Â¸.â€¢*Â´Â¨`*â€¢.Â¸Â¸.â€¢*Â´Â¨`*â€¢.Â¸Â¸.â€¢','background: linear-gradient(to right,green,white,white,green); color:black;text-shadow: 0 0 8px white;');
    /* eslint-enable no-console */
 
 
    return {
        /* Repeating Sections */
        repeatingSimpleSum: repeatingSimpleSum,
        repeating: repeating,
 
        /* Configuration */
        config: setConfigOption,
 
        /* Debugging */
        callback: wrapCallback,
        callstack: logCallstack,
        debugMode: debugMode,
        isDebugMode: isDebugMode,
        _fn: wrapCallback,
 
        /* Logging */
        debug: logDebug,
        error: logError,
        warn: logWarn,
        info: logInfo,
        notice: logNotice,
        log: logLog
    };
}());
 
/* ---- END: TheAaronSheet.js ---- */


var SWUtils = SWUtils || (function () {
	'use strict';
	/* for interaction with ExExp, and some basic utils that have nothing to do with Pathfinder rules. */
	/** Determines if string can be evaluated to a number
	* ensures:  no macro calls, dropdowns, or keep highest/lowest more than 1
	* allows: floor, abs, kh1, kl1,  ceil, round, max, min
	*@param {string} preeval string to examine
	*@returns {bool} true if string will evaluate to a number.
	*/
	var validNumericStr = function (preeval) {
		var anyIllegal = preeval.match(/\||\?|&|\{|\}|k[h,l][^1]/);
		if (anyIllegal) {
			return false;
		}
		anyIllegal = preeval.replace(/floor|ceil|round|abs|max|min|kh1|kl1/g, '');
		anyIllegal = anyIllegal.match(/[a-zA-Z]/);
		if (anyIllegal) {
			return false;
		}
		return true;
	},
	/** searches a string for @{attribute} and replaces those with their values, passes result to the callback
	* if error then passes null
	* @param {string} stringToSearch = string containing one or more @{fieldname}
	* @param {function(string)} callback when done passes resultant string to callback
	*/
	findAndReplaceFields = function (stringToSearch, callback) {
		var fieldnames ;
		if (typeof callback !== "function") {
			return;
		}
		if (!stringToSearch) {
			callback(null);
			return;
		}
		try {
			stringToSearch = stringToSearch.split("selected|").join("");
			stringToSearch = stringToSearch.split("target|").join("");
			fieldnames = stringToSearch.match(/\@\{[^}]+\}/g);
			if (!fieldnames) {
				callback(stringToSearch);
				return;
			}
			fieldnames=fieldnames.sort();
			fieldnames = _.uniq(fieldnames,true);
			fieldnames = _.map(fieldnames,function(field){
				return field.slice(2,-1);
			});
			getAttrs(fieldnames, function (values) {
				var evalstr = stringToSearch, innermatches=null,initialsplit;
				try {
					_.each(fieldnames,function(field){
						//evalstr = evalstr.replace(  new RegExp(escapeForRegExp('@{'+field+'}'),'g'), values[field]);
						initialsplit = evalstr.split('@{'+field+'}');
						evalstr = initialsplit.join(values[field]);
					});
					innermatches=evalstr.match(/\@\{[^}]+\}/g);
				} catch (err2) {
					TAS.error("findAndReplaceFields", err2);
					evalstr = null;
				} finally {
					if (innermatches) {
						findAndReplaceFields(evalstr,callback);
					} else {
						callback(evalstr);
					}
				}
			});
		} catch (err) {
			TAS.error("findAndReplaceFields", err);
			callback(null);
		}
	},
	/** Replaces kl1 and kh1 with min and max
	* example: replaces {x,y}kh1 with min(x,y)
	* @param {string} str the string to search
	* @returns {string} the resultant string after performing the replace
	*/
	convertKL1KH1toMinMax = function (str) {
		var matches;
		//TAS.debug("at convertKL1KH1toMinMax for "+str) ;
		if (str) {
			matches = str.match(/(\{[^}]+\})(kh1|kl1)(?!.*\1)/g);
			//TAS.debug("matches are:",matches);
			if (matches && matches.length > 0) {
				str = _.reduce(matches, function (memo, match) {
					var isMin = /kl1$/.test(match),
					isMax = /kh1$/.test(match),
					newFunc = isMin ? "min" : (isMax ? "max" : ""),
					newMatch = match.slice(1, match.length - 4),
					replaceStr = newFunc + "(" + newMatch + ")";
					return memo.replace(match, replaceStr);
				}, str);
			}
		}
		return str;
	},
	/** Reads in the string, evaluates it to a single number, passes that number to a callback
	* calls callback with: the number, 0 (if exprStr empty), or null if an error is encountered
	*@param {string} exprStr A string containing a mathematical expression, possibly containing references to fields such as @{myfield}
	*@param {function(Number)} callback a function taking one parameter - could be int or float
	*/
	evaluateExpression = function (exprStr, callback) {
		var bmatches1 = 0, bmatches2 = 0, pmatches1 = 0, pmatches2 = 0, smatches1 = 0, smatches2 = 0;
		if (typeof callback !== "function") {
			return;
		}
		if (exprStr === "" || exprStr === null || exprStr === undefined) {
			callback(0);
			return;
		}
		//verify that same number of parenthesis exists
		bmatches1 = (exprStr.match(/\(/g) || []).length;
		bmatches2 = (exprStr.match(/\)/g) || []).length;
		pmatches1 = (exprStr.match(/\{/g) || []).length;
		pmatches2 = (exprStr.match(/\}/g) || []).length;
		smatches1 = (exprStr.match(/\[/g) || []).length;
		smatches2 = (exprStr.match(/\]/g) || []).length;
		if (bmatches1 !== bmatches2 || pmatches1 !== pmatches2 || smatches1 !== smatches2) {
			TAS.warn("evaluateExpression: Mismatched brackets, cannot evaluate:" + exprStr);
			callback(null);
			return;
		}

		findAndReplaceFields(exprStr, function (replacedStr) {
			var evaluated,
			newexprStr;
			//TAS.debug("search and replace of " + exprStr + " resulted in " + replacedStr);
			if (replacedStr === null || replacedStr === undefined) {
				callback(null);
				return;
			}
			try {
				replacedStr = replacedStr.replace(/\s+/g, '').replace(/\[\[/g, "(").replace(/\]\]/g, ")").replace(/\[/g, "(").replace(/\]/g, ")");
				newexprStr = convertKL1KH1toMinMax(replacedStr);
				//TAS.debug("replacedStr is now "+newexprStr);
				if (newexprStr !== replacedStr) {
					replacedStr = newexprStr;
				}
				if (!isNaN(Number(replacedStr)) && isFinite(replacedStr)) {
					evaluated = parseFloat(replacedStr);
					if (!isNaN(evaluated)) {
						callback(evaluated);
						return;
					}
				}
				if (typeof replacedStr !== "undefined" && replacedStr !== null && validNumericStr(replacedStr)) {
					evaluated = ExExp.handleExpression(replacedStr);
					if (!isNaN(evaluated)) {
						callback(evaluated);
					} else {
						TAS.warn("cannot evaluate this to number: " + exprStr +" came back with " + replacedStr);
						callback(null);
					}
				} else {
					TAS.warn("cannot evaluate this to number: " + exprStr+" came back with " + replacedStr);
					callback(null);
				}
			} catch (err3) {
				TAS.error("error trying to convert to number:" + err3);
				callback(null);
			}
		});
	},
	/** evaluateAndSetNumber
	 * Examines the string in readField, and tests to see if it is a number
	 * if it's a number immediately write it to writeField.
	 * if not, then replace any @{field} references with numbers, and then evaluate it
	 * as a mathematical expression till we find a number.
	 *
	 * note this is NOT recursive, you can't point one field of
	 *
	 * @param {string} readField= field to read containing string to parse
	 * @param {string} writeField= field to write to
	 * @param {number} defaultVal= optional, default to set if we cannot evaluate the field. If not supplied assume 0
	 * @param {function} callback - function(newval, oldval, ischanged)
	 * @param {bool} silently if true set new val with {silent:true}
	 * @param {bool} dontSetErrorFlag if true and we could not evaluate, then set attribute named writeField+"_error" to 1
	 * @param {function} errcallback  call if there was an error parsing string function(newval, oldval, ischanged)
	 */
	evaluateAndSetNumber = function (readField, writeField, defaultVal, callback, silently, errcallback) {
		var 
		done = function (a, b, c,currError) {
			var donesetter={};
			if (currError){
				donesetter[writeField+'_error']=0;
				setAttrs(donesetter,{silent:true});
			}
			if (typeof callback === "function") {
				callback(a, b, c);
			}
		},
		errordone = function(a,b,c,currError){
			var donesetter={};
			//TAS.debug("leaving set of "+ writeField+" with old:"+b+", new:"+c+" is changed:"+ c+" and curreerror:"+currError);
			if (!currError){
				donesetter[writeField+'_error']=1;
				setAttrs(donesetter,{silent:true});				
			}
			if (typeof errcallback === "function") {
				errcallback(a, b, c);
			} else if (typeof callback === "function") {
				callback(a, b, c);
			}
		};
		getAttrs([readField, writeField, writeField+"_error"], function (values) {
			var setter = {},
			params = {},
			trueDefault=0, 
			currVal=0,
			isError=0,
			currError=0,
			isChanged=false,
			value=0;	
			try {
				if (silently){params.silent=true;}
				currError= parseInt(values[writeField+"_error"],10)||0;
				trueDefault = defaultVal || 0;
				currVal = parseInt(values[writeField], 10);
				value = Number(values[readField]);
				//check for blank
				if (typeof values[readField] === "undefined" || !values[readField] || values[readField]===null || values[readField]==="" ) {
					//if value of readField is blank then set to defaultval.
					value = trueDefault;
					if (currVal !== value || isNaN(currVal)) {
						setter[writeField] = value;
						setAttrs(setter, params, function () {
							done(value, currVal, true,currError);
						});
					} else {
						done(value, currVal, false,currError);
					}
				} else if (!isNaN(value)) {
					//check for number
					if (currVal !== value) {
						setter[writeField] = value;
						setAttrs(setter, params, function () {
							done(value, currVal, true);
						});
					} else {
						done(value, currVal, false,currError);
					}
				} else {
					//pass to evaluateExpression 
					evaluateExpression(values[readField], function (value2) {
						try {
							if (value2 === null || value2===undefined || isNaN(value2)) {
								isError=1;
								value2=trueDefault;
								//TAS.debug("setting "+ writeField+" to " +value2);
							}
							if (isNaN(currVal) || currVal !== value2) {
								setter[writeField] = value2;
							} 
							if (_.size(setter)>0){
								isChanged=true;
							}
						} catch (err2) {
							TAS.error("SWUtils.evaluateAndSetNumber error after call to evaluateExpression ", err2);
							isError=1;
						} finally {
							setAttrs(setter, params, function () {
								if (!isError){
									done(value2, currVal, isChanged,currError);
								} else {
									errordone(value2,currVal,isChanged,currError);
								}
							});

						}
					});
				}
			} catch (err) {
				TAS.error("SWUtils.evaluateAndSetNumber", err);
				setter[writeField+'_error']=1;
				setAttrs(setter,{silent:true},function(){errordone(value, currVal, false,currError);});
			}
		});
	},
	/** Reads dropdown value, determines attribute referenced, gets that attribute value, passes it to callback.
	* similar to evaluateAndSetNumber but uses a synchronus function to perform search and replace, and assumes the string is only one value not an expression.
	* necessary because some dropdowns have other text in the dropdowns, so we can't use the dropdown value exactly as is.
	* called by setDropdownValue
	* @param {string} readField the attribute name of dropdown we are looking at
	* @param {function} synchrousFindAttributeFunc reads in the value of the dropdown field, and returns the exact name of the attribute to look up (since some dropdowns have other text in value)
	* @param {function(int)} callback pass the value the dropdown selection represents
	*   exceptions: if readField is not found pass in "", if readField is 0 or starts with 0 pass in 0.
	*/
	getDropdownValue = function (readField, synchrousFindAttributeFunc, callback) {
		if (!readField || (callback && typeof callback !== "function") || typeof synchrousFindAttributeFunc !== "function") {
			return;
		}
		getAttrs([readField], function (values) {
			var fieldToFind = values[readField],
			foundField = "";
			if (typeof fieldToFind === "undefined" || fieldToFind === null) {
				callback("");
			} else if (fieldToFind === "0" || fieldToFind === 0 || fieldToFind.indexOf("0") === 0) {
				//select = none
				callback(0);
			} else {
				foundField = synchrousFindAttributeFunc(fieldToFind);
				getAttrs([foundField], function (v) {
					var valueOf = parseInt(v[foundField], 10) || 0;
					callback(valueOf, foundField);
				});
			}
		});
	},
	/** Looks at a dropdown value, and sets writeField(s) with the number to which selected option refers.
	* calls getDropdownValue
	* @param {string} readField the dropdown field
	* @param {string_or_Array} writeFields Field(s) to write the value to
	* @param {function} synchrousFindAttributeFunc takes value of @readField and says what the lookup field is.
	* @param {function(int)} callback (optional) if we need to update the field, call this function
	*         with the value we set as the only parameter.
	* @param {bool} silently if true call setAttrs with {silent:true}
	*/
	setDropdownValue = function (readField, writeFields, synchrousFindAttributeFunc, callback, silently) {
		var done = function (newval, currval, changed) {
			if (typeof callback === "function") {
				callback(newval, currval, changed);
			}
		};
		SWUtils.getDropdownValue(readField, synchrousFindAttributeFunc, function (valueOf) {
			var params = {};
			if (silently) {params.silent=true;}
			if (Array.isArray(writeFields) && writeFields.length === 1) {
				writeFields = writeFields[0];
			}
			if (typeof writeFields === "string") {
				getAttrs([writeFields], function (v) {
					var currValue = parseInt(v[writeFields], 10),
					setter = {};
					//TAS.debug("setDropdownValue, readField:" + readField + ", currValue:" + currValue + ", newValue:" + valueOf);
					if (currValue !== valueOf || isNaN(currValue)) {
						setter[writeFields] = valueOf;
						setAttrs(setter, params, function () {
							done(valueOf, currValue, true);
						});
					} else {
						done(valueOf, currValue, false);
					}
				});
			} else if (Array.isArray(writeFields)) {
				getAttrs(writeFields, function (v) {
					var i = 0,
					setter = {};
					for (i = 0; i < writeFields.length; i++) {
						if (parseInt(v[writeFields[i]], 10) !== valueOf) {
							setter[writeFields[i]] = valueOf;
						}
					}
					if (_.size(setter) > 0) {
						setAttrs(setter, params, function () {
							done(valueOf, 0, true);
						});
					} else {
						done(valueOf, 0, false);
					}
				});
			}
		});
	},
	/** getRowTotal return newvalue, currentvalue, allvalues in callback. Summed up floats and round total to int. 
	* THIS IS PROBABLY SLOWER THAN DOING IT YOURSELF, just wrote to make things simpler.
	* @param {Array} fields array of field names to be added up, EXCEPT the first field which is ignored (at index 0) which is the total current value
	* @param {number} bonus a number that is added to the other fields.
	* @param {Array} penalties array of fieldnames whose values are to be subtracted from the total
	* @param {boolean} totalIsFloat true if we should not round the total to int.
	* @param {function(number,number)} callback call this with: new total, current total
	* @param {function} errorCallback call if error attempting to add.
	*/
	getRowTotal = function (fields, bonus, penalties, totalIsFloat, callback, errorCallback) {
		var readFields;
		if (typeof callback !== "function" || typeof errorCallback !== "function") {
			return;
		}
		try {
			if (!fields || (!Array.isArray(fields)) || fields.length === 0) {
				return;
			}
			if (penalties && Array.isArray(penalties) && penalties.length > 0) {
				readFields = fields.concat(penalties);
			} else {
				readFields = fields;
			}
		} catch (err2) {
			TAS.error("SWUtils.getRowTotal catastrophic error: ", err2);
			errorCallback();
			return;
		}
		getAttrs(readFields, function (v) {
			var currValue = totalIsFloat ? parseFloat(v[fields[0]]) : parseInt(v[fields[0]], 10),
			newValue = 0,
			penalty = 0,
			i; //, setter = {}
			try {
				//remember start at 1
				for (i = 1; i < fields.length; i++) {
					newValue += parseFloat(v[fields[i]]) || 0;
				}
				if (bonus && !isNaN(parseInt(bonus, 10))) {
					newValue += parseFloat(bonus);
				}
				if (penalties) {
					for (i = 0; i < penalties.length; i++) {
						penalty += parseFloat(v[penalties[i]]) || 0;
					}
					newValue -= penalty;
				}
				if (!totalIsFloat) {
					newValue = Math.floor(newValue);
				}
				callback(newValue, currValue);
			} catch (err) {
				TAS.error("SWUtils.getRowTotal", err);
				errorCallback();
			}
		});
	},
	/** Adds up numbers and puts it in the first field of the fields array.
	* All numbers are added up as FLOATS, and then FLOOR is used to round the sum down
	* @param {Array} fields array of field names to be added up, EXCEPT the first field. fields[0] MUST be the total field
	* @param {number} bonus a number that is added to the other fields.
	* @param {Array} penalties array of fieldnames whose values are to be subtracted from the total
	* @param {boolean} totalIsFloat true if we should not round the total to int.
	* @param {function(number,number)} callback optional call this with two values: the new total, old total
	* @param {bool} silently if true call setAttrs with {silent:true}
	*/
	updateRowTotal = function (fields, bonus, penalties, totalIsFloat, callback, silently) {
		var done = function () {
			if (typeof callback === "function") {
				callback();
			}
		};
		getRowTotal(fields, bonus, penalties, totalIsFloat, function (newValue, currValue) {
			var setter = {},
			params = {};
			try {
				if (newValue !== currValue) {
					setter[fields[0]] = newValue;
				}
			} catch (err) {
				TAS.error("PFUtilsAsync.updateRowTotal", err);
			} finally {
				if (_.size(setter) > 0) {
					if (silently) {
						params.silent=true;
					}
					setAttrs(setter, params, done);
				} else {
					done();
				}
			}
		}, done);
	},
	/** Escapes special chars for regex
	*@param {string} str the string to examine
	*@param {boolean} escapeSpaces if we should replace any space with \s* (caller can use it for matching purposes)
	*@returns {string} resultant string after search and replace
	*/
	escapeForRegExp = function (str, escapeSpaces) {
		var regexEscapes = /[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\~\!\@\#]/g,
		tempstr ='';
		if (str) {
			tempstr = str.replace(regexEscapes, "\\$&");
			if (escapeSpaces){
				//replace space plus multiple spaces with non escaped 0 or * space.
				tempstr = tempstr.replace(/\t+|\s+/g,'\\s*');
			}
		}
		return tempstr;
	},
	/** Escapes special chars for macros - to create sub queries - this is not used currently
	*@param {string} str the string to examine
	*@returns {string} resultant string after search and replace
	*/
	escapeForMacroCall = function (str) {
		var macroCallEscapes = [ [/\{\{/g, '&#123;&#123;'],
			[/\}\}/g, '&#125;&#125;'],
			[/\(/g, '&#40;'],
			[/\)/g, '&#41;'],
			[/\,/g, '&#44;'],
			[/\?/g, '&#63;'],
			[/'/g, '&#39;'],
			[/"/g, '&#34;'],
			[/\=/g, '&#61;'] ];
		if (str) {
			return _.reduce(macroCallEscapes, function (currStr, pair) {
				return currStr.replace(pair[0], pair[1]);
			}, str);
		}
		return "";
	},
	/** Escapes '{{' for passing to a rolltemplate
	*@param {string} str the string to examine
	*@returns {string} resultant string after search and replace
	*/
	escapeForRollTemplate = function (str) {
		if (!str){return str;}
		return str.replace(/\{\{/g, '&#123;&#123;');
	},
	/** escapes string so it can be used in the name section of another link button
	*if it finds [name](link) in a string it will remove the [ and ] and the (link)
	* replaces [ and ] with escaped versions everywhere else.
	*@param {string] str the string we want to use inside a link button
	*@returns {string} safe to use new name for button
	*/
	escapeForChatLinkButton = function(str){
		var markdownLinkreg=/^([^\[]*?)\[([^\]]*?)\]\(([^\)]*?)\)(.*)$/,
			retstr="", matches;
		if (!str){return str;}
		matches = markdownLinkreg.exec(str);
		if(matches){
			if (matches[1]){
				retstr+=matches[1];
			}
			if(matches[2]){
				retstr += matches[2];
			}
			if (matches[4]){
				retstr += matches[4];
			}
		} else {
			retstr = str;
		}
		retstr = retstr.replace(/\[/g,'&#91;').replace(/\]/g,'&#93;');
		return retstr;
	},
	/** returns id portion of a source Attribute or repeating row attribute name
	* @param {string} sourceAttribute from eventInfo object
	* @returns {string} the id portion of string, or blank.
	*/
	getRowId = function (sourceAttribute) {
		if (!sourceAttribute) { return ""; }
		var strs = sourceAttribute.split('_');
		if (strs && _.size(strs) >= 4) {
			return strs[2];
		}
		return "";
	},
	getAttributeName = function (source) {
		if (!source) { return ""; }
		var itemId = getRowId(source), attrib = "";
		if (itemId) {
			attrib = source.substring(source.indexOf(itemId) + itemId.length + 1, source.length);
		}
		return attrib;
	},
	/** getRepeatingIDStr - if id is not empty, then returns the ID with an underscore on the right. else returns empty string
	* this is used so the same function can be written for loops from getIDs or direct from the event with no ID
	*@param {string} id the id of the row or blank
	*@returns {string} id_  or blank
	*/
	getRepeatingIDStr = function (id) {
		var idStr = "";
		if (!(id === null || id === undefined)) {
			idStr = id + "_";
		}
		return idStr;
	},
	/** Append values of multiple arrays of strings together to return one NEW array of strings that is the cartesian product.
	* @example cartesianAppend(["a","b"],["c","d"], ["e","f"]);
	* // returns ["ace","acf","ade","adf","bce","bcf","bde","bdf"]
	* @example cartesianAppend(["pre_"] , ["a","b","c"], ["_post"] );
	* //returns ["pre_a_post","pre_b_post","pre_c_post"]
	* @param {Array} [...] Arrays of strings
	* @returns {Array} of all values in other arrays
	*/
	cartesianAppend = function () {
		return _.reduce(arguments, function (a, b) {
			return _.flatten(_.map(a, function (x) {
				return _.map(b, function (y) {
					return String(x) + String(y);
				});
			}), true);
		}, [[]]);
	},
	/** Concatenates cartesian product of all arrays together returns one flattened NEW array.
	* @param {Array} [...] Arrays
	* @returns {Array} cartesian product of all arrays (concatenated nothing else)
	*/
	cartesianProduct = function () {
		return _.reduce(arguments, function (a, b) {
			return _.flatten(_.map(a, function (x) {
				return _.map(b, function (y) {
					return x.concat([y]);
				});
			}), true);
		}, [[]]);
	},
	/** trimBoth removes spaces at beginning and end of string, or of each string in an array.
	* performs a deep match, so if array is of arrays, will call trim on every string. 
	* if object is not an array or string, just return object.
	* therefore, non immutable objects are not cloned and array will contain links to them.
	*@param {Array or string} val string or array of strings
	*@returns {Array or string} same object type as passed in 
	*/
	trimBoth = function(val){
		if (Array.isArray(val)){
			return _.map(val,trimBoth);
		}
		if (typeof val === 'string') {
			return val.replace(/^\s*|\s*$/g,'');
		}
		return val;
	}
	;
	return {
		cartesianAppend: cartesianAppend,
		cartesianProduct: cartesianProduct,
		convertKL1KH1toMinMax: convertKL1KH1toMinMax,
		escapeForRegExp: escapeForRegExp,
		escapeForRollTemplate: escapeForRollTemplate,
		searchAndReplaceFields: findAndReplaceFields,
		findAndReplaceFields: findAndReplaceFields,
		evaluateExpression: evaluateExpression,
		getRowId: getRowId,
		getAttributeName: getAttributeName,
		evaluateAndSetNumber: evaluateAndSetNumber,
		escapeForChatLinkButton: escapeForChatLinkButton,
		getDropdownValue: getDropdownValue,
		setDropdownValue: setDropdownValue,
		getRowTotal: getRowTotal,
		updateRowTotal: updateRowTotal,
		getRepeatingIDStr: getRepeatingIDStr,
		validNumericStr: validNumericStr,
		trimBoth: trimBoth
	};
}());
</script>
